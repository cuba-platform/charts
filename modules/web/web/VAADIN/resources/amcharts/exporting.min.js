AmCharts.AmExport=AmCharts.Class({construct:function(chart,cfg){var _this=this;_this.DEBUG=false;_this.chart=chart;_this.canvas=null;_this.svgs=[];_this.cfg={menuTop:"auto",menuLeft:"auto",menuRight:"0px",menuBottom:"0px",menuItems:[{textAlign:"center",icon:_this.chart.pathToImages+"export.png",iconTitle:"Save chart as an image",format:"png"}],menuItemStyle:{backgroundColor:"transparent",rollOverBackgroundColor:"#EFEFEF",color:"#000000",rollOverColor:"#CC0000",paddingTop:"6px",paddingRight:"6px",paddingBottom:"6px",paddingLeft:"6px",marginTop:"0px",marginRight:"0px",marginBottom:"0px",marginLeft:"0px",textAlign:"left",textDecoration:"none",fontFamily:_this.chart.fontFamily,fontSize:_this.chart.fontSize+"px"},menuItemOutput:{backgroundColor:"#FFFFFF",fileName:"amChart",format:"png",output:"dataurlnewwindow",render:"browser",dpi:90,onclick:function(instance,config,event){event.preventDefault();instance.polifySVG();instance.output(config);}},removeImagery:false};_this.processing={buffer:[],drawn:0,timer:0};if(typeof(window.canvg)!="undefined"&&typeof(window.RGBColor)!="undefined"){_this.cfg.menuItemOutput.render="canvg";}if(typeof(window.saveAs)!="undefined"){_this.cfg.menuItemOutput.output="save";}if(AmCharts.isIE&&AmCharts.IEversion<10){_this.cfg.menuItemOutput.output="dataurlnewwindow";}if(cfg){cfg.menuItemOutput=AmCharts.extend(_this.cfg.menuItemOutput,cfg.menuItemOutput||{});cfg.menuItemStyle=AmCharts.extend(_this.cfg.menuItemStyle,cfg.menuItemStyle||{});_this.cfg=AmCharts.extend(_this.cfg,cfg);}_this.chart.AmExport=_this;_this.chart.addListener("rendered",function(){_this.setup();});if(_this.DEBUG){window.AmExport=_this;}},log:function(){console.log("AmExport: ",arguments);},setup:function(){var _this=this;if(_this.DEBUG==10){_this.log("SETUP START");}if(!AmCharts.isIE||(AmCharts.isIE&&AmCharts.IEversion>9)){_this.generateButtons();if(_this.DEBUG==10){_this.log("SETUP END");}}else{if(_this.DEBUG==10){_this.log("< IE10 NOT SUPPORTED");}}},generateBinaryArray:function(base64_string){var len=base64_string.length,buffer=new Uint8Array(len/4*3|0),i=0,outptr=0,last=[0,0],state=0,save=0,rank,code,undef,base64_ranks=new Uint8Array([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51]);while(len--){code=base64_string.charCodeAt(i++);rank=base64_ranks[code-43];if(rank!==255&&rank!==undef){last[1]=last[0];last[0]=code;save=(save<<6)|rank;state++;if(state===4){buffer[outptr++]=save>>>16;if(last[1]!==61){buffer[outptr++]=save>>>8;}if(last[0]!==61){buffer[outptr++]=save;}state=0;}}}return buffer;},generateBlob:function(datastring,type){var _this=this,header_end=datastring.indexOf(",")+1,header=datastring.substring(0,header_end),data=datastring,blob=new Blob();if(header.indexOf("base64")!=-1){data=_this.generateBinaryArray(datastring.substring(header_end));}if(AmCharts.isIE&&AmCharts.IEversion<10){blob.data=data;blob.size=data.length;blob.type=type;blob.encoding="base64";}else{blob=new Blob([data],{type:type});}return blob;},generatePDF:function(cfg){var _this=this,pdf={output:function(){return"";}},data=_this.canvas.toDataURL("image/jpeg"),width=(_this.canvas.width*25.4)/cfg.dpi,height=(_this.canvas.height*25.4)/cfg.dpi;if(window.jsPDF){pdf=new jsPDF();if(pdf.addImage){pdf.addImage(data,"JPEG",0,0,width,height);}else{alert("Missing jsPDF plugin; Please add the 'addImage' plugin.");}}else{alert("Missing jsPDF lib; Don't forget to add the addImage plugin.");}return pdf;},output:function(cfg,externalCallback){var _this=this;cfg=AmCharts.extend(AmCharts.extend({},_this.cfg.menuItemOutput),cfg||{});function internalCallback(){var data=null;var blob;if(_this.DEBUG==10){_this.log("OUTPUT",format);}if(cfg.format=="image/svg+xml"||cfg.format=="svg"){for(var i=0;i<_this.processing.buffer.length;i++){data=new XMLSerializer().serializeToString(_this.processing.buffer[i][0]);blob=_this.generateBlob(data,"image/svg+xml");if(cfg.output=="save"){saveAs(blob,cfg.fileName+".svg");}else{if(cfg.output=="datastring"||cfg.output=="datauristring"||cfg.output=="dataurlstring"){blob="data:image/svg+xml;base64,"+btoa(data);}else{if(cfg.output=="dataurlnewwindow"){window.open("data:image/svg+xml;base64,"+btoa(data));}else{if(cfg.output=="datauri"||cfg.output=="dataurl"){location.href="data:image/svg+xml;base64,"+btoa(data);}else{if(cfg.output=="datastream"){location.href="data:image/octet-stream;base64,"+btoa(data);}}}}}if(externalCallback){externalCallback.apply(_this,[blob]);}}}else{if(cfg.format=="application/pdf"||cfg.format=="pdf"){data=_this.generatePDF(cfg).output("dataurlstring");blob=_this.generateBlob(data,"application/pdf");if(cfg.output=="save"){saveAs(blob,cfg.fileName+".pdf");}else{if(cfg.output=="datastring"||cfg.output=="datauristring"||cfg.output=="dataurlstring"){blob=data;}else{if(cfg.output=="dataurlnewwindow"){window.open(data);}else{if(cfg.output=="datauri"||cfg.output=="dataurl"){location.href=data;}else{if(cfg.output=="datastream"){location.href=data.replace("application/pdf","application/octet-stream");}}}}}if(externalCallback){externalCallback.apply(_this,[blob]);}}else{if(cfg.format=="image/png"||cfg.format=="png"){data=_this.canvas.toDataURL("image/png");blob=_this.generateBlob(data,"image/png");if(cfg.output=="save"){saveAs(blob,cfg.fileName+".png");}else{if(cfg.output=="datastring"||cfg.output=="datauristring"||cfg.output=="dataurlstring"){blob=data;}else{if(cfg.output=="dataurlnewwindow"){window.open(data);}else{if(cfg.output=="datauri"||cfg.output=="dataurl"){location.href=data;}else{if(cfg.output=="datastream"){location.href=data.replace("image/png","image/octet-stream");}}}}}if(externalCallback){externalCallback.apply(_this,[blob]);}}else{if(cfg.format=="image/jpeg"||cfg.format=="jpeg"||cfg.format=="jpg"){data=_this.canvas.toDataURL("image/jpeg");blob=_this.generateBlob(data,"image/jpeg");if(cfg.output=="save"){saveAs(blob,cfg.fileName+".jpg");}else{if(cfg.output=="datastring"||cfg.output=="datauristring"||cfg.output=="dataurlstring"){blob=data;}else{if(cfg.output=="dataurlnewwindow"){window.open(data);}else{if(cfg.output=="datauri"||cfg.output=="dataurl"){location.href=data;}else{if(cfg.output=="datastream"){location.href=data.replace("image/jpeg","image/octet-stream");}}}}}if(externalCallback){externalCallback.apply(_this,[blob]);}}}}}}return _this.generateOutput(cfg,internalCallback);},polifySVG:function(){var _this=this;var svgs=_this.chart.div.getElementsByTagName("svg");function recursiveChange(svg,tag){var items=svg.getElementsByTagName(tag);for(var i=0;i<items.length;i++){if(_this.cfg.removeImagery){items[i].parentNode.removeChild(items[i]);}else{var image=document.createElement("img");var canvas=document.createElement("canvas");var ctx=canvas.getContext("2d");canvas.width=items[i].getAttribute("width");canvas.height=items[i].getAttribute("height");image.src=items[i].getAttribute("xlink:href");image.width=items[i].getAttribute("width");image.height=items[i].getAttribute("height");try{ctx.drawImage(image,0,0,image.width,image.height);datastring=canvas.toDataURL();}catch(err){datastring=image.src;_this.log("Tainted canvas, reached browser CORS security; origin from imagery must be equal to the server!");throw new Error(err);}items[i].setAttribute("xlink:href",datastring);}if(_this.DEBUG==10){_this.log("POLIFIED",items[i]);}}}for(var i=0;i<svgs.length;i++){var parent=svgs[i].parentNode;if(_this.DEBUG==10){_this.log("POLIFIED",svgs[i]);}recursiveChange(svgs[i],"pattern");recursiveChange(svgs[i],"image");_this.svgs.push(svgs[i]);}return svgs;},generateOutput:function(cfg,callback){var _this=this,svgs=_this.chart.div.getElementsByTagName("svg"),canvas=document.createElement("canvas"),context=canvas.getContext("2d"),offset={y:0,x:0},tmp={};_this.processing.buffer=[];_this.processing.drawn=0;_this.canvas=canvas;if(_this.DEBUG==10){_this.log("START EXPORT");}if(_this.DEBUG==10){_this.log("START BUFFERING");}for(var i=0;i<svgs.length;i++){var parent=svgs[i].parentNode,svgX=Number(parent.style.left.slice(0,-2)),svgY=Number(parent.style.top.slice(0,-2));tmp=AmCharts.extend({},offset);offset.x=svgX?svgX:offset.x;offset.y=svgY?svgY:offset.y;_this.processing.buffer.push([svgs[i],AmCharts.extend({},offset)]);if(svgY&&svgX){offset=tmp;}else{offset.y+=svgY?0:parent.offsetHeight;}if(_this.DEBUG==10){_this.log("BUFFERED",svgs[i],offset);}}if(_this.DEBUG==10){_this.log("END BUFFERING");}if(_this.DEBUG==10){_this.log("START DRAWING",cfg.render);}if(_this.DEBUG==10){_this.log("FILL BACKGROUND");}canvas.id=AmCharts.getUniqueId();canvas.width=_this.chart.divRealWidth;canvas.height=_this.chart.divRealHeight;if(cfg.backgroundColor||format=="image/jpeg"){context.fillStyle=cfg.backgroundColor||"#FFFFFF";context.fillRect(0,0,canvas.width,canvas.height);}function drawItWhenItsLoaded(){var img,buffer,offset,source;if(_this.processing.buffer.length==_this.processing.drawn){if(_this.DEBUG==10){_this.log("END DRAWING");}return callback();}else{if(_this.DEBUG==10){_this.log("DRAW",_this.processing.drawn+1,"OF",_this.processing.buffer.length);}buffer=_this.processing.buffer[_this.processing.drawn];source=new XMLSerializer().serializeToString(buffer[0]);offset=buffer[1];if(_this.DEBUG==10){_this.log("SOURCE",source);}if(cfg.render=="browser"){img=new Image();img.id=AmCharts.getUniqueId();source="data:image/svg+xml;base64,"+btoa(source);img.onload=function(){context.drawImage(this,buffer[1].x,buffer[1].y);_this.processing.drawn++;if(_this.DEBUG==10){_this.log("ONLOAD",this);}drawItWhenItsLoaded();};img.onerror=function(){if(_this.DEBUG==10){_this.log("ONERROR",this);}context.drawImage(this,buffer[1].x,buffer[1].y);_this.processing.drawn++;drawItWhenItsLoaded();};img.src=source;if(_this.DEBUG==10){_this.log("ADD",img);}if(img.complete||typeof(img.complete)=="undefined"||img.complete===undefined){if(_this.DEBUG==10){_this.log("FORCE ONLOAD",img);}img.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";img.src=source;}}else{if(cfg.render=="canvg"){canvg(canvas,source,{offsetX:offset.x,offsetY:offset.y,ignoreMouse:true,ignoreAnimation:true,ignoreDimensions:true,ignoreClear:true,renderCallback:function(){_this.processing.drawn++;drawItWhenItsLoaded();}});}}}}return drawItWhenItsLoaded();},generateButtons:function(){var _this=this,div=document.createElement("div"),lvl=0;function createList(items){var ul=document.createElement("ul");ul.setAttribute("style","list-style: none; margin: 0; padding: 0;");for(var i=0;i<items.length;i++){var li=document.createElement("li"),img=document.createElement("img"),a=document.createElement("a"),item=items[i],children=null,itemStyle=AmCharts.extend(AmCharts.extend({},_this.cfg.menuItemStyle),items[i]);item=AmCharts.extend(AmCharts.extend({},_this.cfg.menuItemOutput),item);if(item["icon"]){img.alt="";img.src=item["icon"];img.setAttribute("style","margin: 0 auto;border: none;outline: none");if(item["iconTitle"]){img.title=item["iconTitle"];}a.appendChild(img);}a.href="#";if(item["title"]){img.setAttribute("style","margin-right: 5px;");a.innerHTML+=item.title;}a.setAttribute("style","display: block;");AmCharts.extend(a.style,itemStyle);a.onclick=item.onclick.bind(a,_this,item);li.appendChild(a);if(item.items){children=createList(item.items);li.appendChild(children);li.onmouseover=function(){children.style.display="block";};li.onmouseout=function(){children.style.display="none";};children.style.display="none";}ul.appendChild(li);a.onmouseover=function(){this.style.backgroundColor=itemStyle.rollOverBackgroundColor;this.style.color=itemStyle.rollOverColor;this.style.borderColor=itemStyle.rollOverBorderColor;};a.onmouseout=function(){this.style.backgroundColor=itemStyle.backgroundColor;this.style.color=itemStyle.color;this.style.borderColor=itemStyle.borderColor;};}lvl++;if(_this.DEBUG==10){_this.log("MENU",ul);}return ul;}div.setAttribute("style","position: absolute;top:"+_this.cfg.menuTop+";right:"+_this.cfg.menuRight+";bottom:"+_this.cfg.menuBottom+";left:"+_this.cfg.menuLeft+";box-shadow:0px 0px 1px 0px rgba(0,0,0,0);");div.appendChild(createList(_this.cfg.menuItems));_this.chart.containerDiv.appendChild(div);}});function RGBColor(color_string){this.ok=false;if(color_string.charAt(0)=="#"){color_string=color_string.substr(1,6);}color_string=color_string.replace(/ /g,"");color_string=color_string.toLowerCase();var simple_colors={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var key in simple_colors){if(color_string==key){color_string=simple_colors[key];}}var color_defs=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(bits){return[parseInt(bits[1]),parseInt(bits[2]),parseInt(bits[3])];}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(bits){return[parseInt(bits[1],16),parseInt(bits[2],16),parseInt(bits[3],16)];}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(bits){return[parseInt(bits[1]+bits[1],16),parseInt(bits[2]+bits[2],16),parseInt(bits[3]+bits[3],16)];}}];for(var i=0;i<color_defs.length;i++){var re=color_defs[i].re;var processor=color_defs[i].process;var bits=re.exec(color_string);if(bits){channels=processor(bits);this.r=channels[0];this.g=channels[1];this.b=channels[2];this.ok=true;}}this.r=(this.r<0||isNaN(this.r))?0:((this.r>255)?255:this.r);this.g=(this.g<0||isNaN(this.g))?0:((this.g>255)?255:this.g);this.b=(this.b<0||isNaN(this.b))?0:((this.b>255)?255:this.b);this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")";};this.toHex=function(){var r=this.r.toString(16);var g=this.g.toString(16);var b=this.b.toString(16);if(r.length==1){r="0"+r;}if(g.length==1){g="0"+g;}if(b.length==1){b="0"+b;}return"#"+r+g+b;};this.getHelpXML=function(){var examples=new Array();for(var i=0;i<color_defs.length;i++){var example=color_defs[i].example;for(var j=0;j<example.length;j++){examples[examples.length]=example[j];}}for(var sc in simple_colors){examples[examples.length]=sc;}var xml=document.createElement("ul");xml.setAttribute("id","rgbcolor-examples");for(var i=0;i<examples.length;i++){try{var list_item=document.createElement("li");var list_color=new RGBColor(examples[i]);var example_div=document.createElement("div");example_div.style.cssText="margin: 3px; "+"border: 1px solid black; "+"background:"+list_color.toHex()+"; "+"color:"+list_color.toHex();example_div.appendChild(document.createTextNode("test"));var list_item_value=document.createTextNode(" "+examples[i]+" -> "+list_color.toRGB()+" -> "+list_color.toHex());list_item.appendChild(example_div);list_item.appendChild(list_item_value);xml.appendChild(list_item);}catch(e){}}return xml;};}(function(){this.canvg=function(target,s,opts){if(target==null&&s==null&&opts==null){var svgTags=document.getElementsByTagName("svg");for(var i=0;i<svgTags.length;i++){var svgTag=svgTags[i];var c=document.createElement("canvas");c.width=svgTag.clientWidth;c.height=svgTag.clientHeight;svgTag.parentNode.insertBefore(c,svgTag);svgTag.parentNode.removeChild(svgTag);var div=document.createElement("div");div.appendChild(svgTag);canvg(c,div.innerHTML);}return;}opts=opts||{};if(typeof target=="string"){target=document.getElementById(target);}if(target.svg!=null){target.svg.stop();}var svg=build();if(!(target.childNodes.length==1&&target.childNodes[0].nodeName=="OBJECT")){target.svg=svg;}svg.opts=opts;var ctx=target.getContext("2d");if(typeof(s.documentElement)!="undefined"){svg.loadXmlDoc(ctx,s);}else{if(s.substr(0,1)=="<"){svg.loadXml(ctx,s);}else{svg.load(ctx,s);}}};function build(){var svg={};svg.FRAMERATE=30;svg.MAX_VIRTUAL_PIXELS=30000;svg.init=function(ctx){var uniqueId=0;svg.UniqueId=function(){uniqueId++;return"canvg"+uniqueId;};svg.Definitions={};svg.Styles={};svg.Animations=[];svg.Images=[];svg.ctx=ctx;svg.ViewPort=new (function(){this.viewPorts=[];this.Clear=function(){this.viewPorts=[];};this.SetCurrent=function(width,height){this.viewPorts.push({width:width,height:height});};this.RemoveCurrent=function(){this.viewPorts.pop();};this.Current=function(){return this.viewPorts[this.viewPorts.length-1];};this.width=function(){return this.Current().width;};this.height=function(){return this.Current().height;};this.ComputeSize=function(d){if(d!=null&&typeof(d)=="number"){return d;}if(d=="x"){return this.width();}if(d=="y"){return this.height();}return Math.sqrt(Math.pow(this.width(),2)+Math.pow(this.height(),2))/Math.sqrt(2);};});};svg.init();svg.ImagesLoaded=function(){for(var i=0;i<svg.Images.length;i++){if(!svg.Images[i].loaded){return false;}}return true;};svg.trim=function(s){return s.replace(/^\s+|\s+$/g,"");};svg.compressSpaces=function(s){return s.replace(/[\s\r\t\n]+/gm," ");};svg.ajax=function(url){var AJAX;if(window.XMLHttpRequest){AJAX=new XMLHttpRequest();}else{AJAX=new ActiveXObject("Microsoft.XMLHTTP");}if(AJAX){AJAX.open("GET",url,false);AJAX.send(null);return AJAX.responseText;}return null;};svg.parseXml=function(xml){if(window.DOMParser){var parser=new DOMParser();return parser.parseFromString(xml,"text/xml");}else{xml=xml.replace(/<!DOCTYPE svg[^>]*>/,"");var xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML(xml);return xmlDoc;}};svg.Property=function(name,value){this.name=name;this.value=value;};svg.Property.prototype.getValue=function(){return this.value;};svg.Property.prototype.hasValue=function(){return(this.value!=null&&this.value!=="");};svg.Property.prototype.numValue=function(){if(!this.hasValue()){return 0;}var n=parseFloat(this.value);if((this.value+"").match(/%$/)){n=n/100;}return n;};svg.Property.prototype.valueOrDefault=function(def){if(this.hasValue()){return this.value;}return def;};svg.Property.prototype.numValueOrDefault=function(def){if(this.hasValue()){return this.numValue();}return def;};svg.Property.prototype.addOpacity=function(opacity){var newValue=this.value;if(opacity!=null&&opacity!=""&&typeof(this.value)=="string"){var color=new RGBColor(this.value);if(color.ok){newValue="rgba("+color.r+", "+color.g+", "+color.b+", "+opacity+")";}}return new svg.Property(this.name,newValue);};svg.Property.prototype.getDefinition=function(){var name=this.value.match(/#([^\)'"]+)/);if(name){name=name[1];}if(!name){name=this.value;}return svg.Definitions[name];};svg.Property.prototype.isUrlDefinition=function(){return this.value.indexOf("url(")==0;};svg.Property.prototype.getFillStyleDefinition=function(e,opacityProp){var def=this.getDefinition();if(def!=null&&def.createGradient){return def.createGradient(svg.ctx,e,opacityProp);}if(def!=null&&def.createPattern){if(def.getHrefAttribute().hasValue()){var pt=def.attribute("patternTransform");def=def.getHrefAttribute().getDefinition();if(pt.hasValue()){def.attribute("patternTransform",true).value=pt.value;}}return def.createPattern(svg.ctx,e);}return null;};svg.Property.prototype.getDPI=function(viewPort){return 96;};svg.Property.prototype.getEM=function(viewPort){var em=12;var fontSize=new svg.Property("fontSize",svg.Font.Parse(svg.ctx.font).fontSize);if(fontSize.hasValue()){em=fontSize.toPixels(viewPort);}return em;};svg.Property.prototype.getUnits=function(){var s=this.value+"";return s.replace(/[0-9\.\-]/g,"");};svg.Property.prototype.toPixels=function(viewPort,processPercent){if(!this.hasValue()){return 0;}var s=this.value+"";if(s.match(/em$/)){return this.numValue()*this.getEM(viewPort);}if(s.match(/ex$/)){return this.numValue()*this.getEM(viewPort)/2;}if(s.match(/px$/)){return this.numValue();}if(s.match(/pt$/)){return this.numValue()*this.getDPI(viewPort)*(1/72);}if(s.match(/pc$/)){return this.numValue()*15;}if(s.match(/cm$/)){return this.numValue()*this.getDPI(viewPort)/2.54;}if(s.match(/mm$/)){return this.numValue()*this.getDPI(viewPort)/25.4;}if(s.match(/in$/)){return this.numValue()*this.getDPI(viewPort);}if(s.match(/%$/)){return this.numValue()*svg.ViewPort.ComputeSize(viewPort);}var n=this.numValue();if(processPercent&&n<1){return n*svg.ViewPort.ComputeSize(viewPort);}return n;};svg.Property.prototype.toMilliseconds=function(){if(!this.hasValue()){return 0;}var s=this.value+"";if(s.match(/s$/)){return this.numValue()*1000;}if(s.match(/ms$/)){return this.numValue();}return this.numValue();};svg.Property.prototype.toRadians=function(){if(!this.hasValue()){return 0;}var s=this.value+"";if(s.match(/deg$/)){return this.numValue()*(Math.PI/180);}if(s.match(/grad$/)){return this.numValue()*(Math.PI/200);}if(s.match(/rad$/)){return this.numValue();}return this.numValue()*(Math.PI/180);};svg.Font=new (function(){this.Styles="normal|italic|oblique|inherit";this.Variants="normal|small-caps|inherit";this.Weights="normal|bold|bolder|lighter|100|200|300|400|500|600|700|800|900|inherit";this.CreateFont=function(fontStyle,fontVariant,fontWeight,fontSize,fontFamily,inherit){var f=inherit!=null?this.Parse(inherit):this.CreateFont("","","","","",svg.ctx.font);return{fontFamily:fontFamily||f.fontFamily,fontSize:fontSize||f.fontSize,fontStyle:fontStyle||f.fontStyle,fontWeight:fontWeight||f.fontWeight,fontVariant:fontVariant||f.fontVariant,toString:function(){return[this.fontStyle,this.fontVariant,this.fontWeight,this.fontSize,this.fontFamily].join(" ");}};};var that=this;this.Parse=function(s){var f={};var d=svg.trim(svg.compressSpaces(s||"")).split(" ");var set={fontSize:false,fontStyle:false,fontWeight:false,fontVariant:false};var ff="";for(var i=0;i<d.length;i++){if(!set.fontStyle&&that.Styles.indexOf(d[i])!=-1){if(d[i]!="inherit"){f.fontStyle=d[i];}set.fontStyle=true;}else{if(!set.fontVariant&&that.Variants.indexOf(d[i])!=-1){if(d[i]!="inherit"){f.fontVariant=d[i];}set.fontStyle=set.fontVariant=true;}else{if(!set.fontWeight&&that.Weights.indexOf(d[i])!=-1){if(d[i]!="inherit"){f.fontWeight=d[i];}set.fontStyle=set.fontVariant=set.fontWeight=true;}else{if(!set.fontSize){if(d[i]!="inherit"){f.fontSize=d[i].split("/")[0];}set.fontStyle=set.fontVariant=set.fontWeight=set.fontSize=true;}else{if(d[i]!="inherit"){ff+=d[i];}}}}}}if(ff!=""){f.fontFamily=ff;}return f;};});svg.ToNumberArray=function(s){var a=svg.trim(svg.compressSpaces((s||"").replace(/,/g," "))).split(" ");for(var i=0;i<a.length;i++){a[i]=parseFloat(a[i]);}return a;};svg.Point=function(x,y){this.x=x;this.y=y;};svg.Point.prototype.angleTo=function(p){return Math.atan2(p.y-this.y,p.x-this.x);};svg.Point.prototype.applyTransform=function(v){var xp=this.x*v[0]+this.y*v[2]+v[4];var yp=this.x*v[1]+this.y*v[3]+v[5];this.x=xp;this.y=yp;};svg.CreatePoint=function(s){var a=svg.ToNumberArray(s);return new svg.Point(a[0],a[1]);};svg.CreatePath=function(s){var a=svg.ToNumberArray(s);var path=[];for(var i=0;i<a.length;i+=2){path.push(new svg.Point(a[i],a[i+1]));}return path;};svg.BoundingBox=function(x1,y1,x2,y2){this.x1=Number.NaN;this.y1=Number.NaN;this.x2=Number.NaN;this.y2=Number.NaN;this.x=function(){return this.x1;};this.y=function(){return this.y1;};this.width=function(){return this.x2-this.x1;};this.height=function(){return this.y2-this.y1;};this.addPoint=function(x,y){if(x!=null){if(isNaN(this.x1)||isNaN(this.x2)){this.x1=x;this.x2=x;}if(x<this.x1){this.x1=x;}if(x>this.x2){this.x2=x;}}if(y!=null){if(isNaN(this.y1)||isNaN(this.y2)){this.y1=y;this.y2=y;}if(y<this.y1){this.y1=y;}if(y>this.y2){this.y2=y;}}};this.addX=function(x){this.addPoint(x,null);};this.addY=function(y){this.addPoint(null,y);};this.addBoundingBox=function(bb){this.addPoint(bb.x1,bb.y1);this.addPoint(bb.x2,bb.y2);};this.addQuadraticCurve=function(p0x,p0y,p1x,p1y,p2x,p2y){var cp1x=p0x+2/3*(p1x-p0x);var cp1y=p0y+2/3*(p1y-p0y);var cp2x=cp1x+1/3*(p2x-p0x);var cp2y=cp1y+1/3*(p2y-p0y);this.addBezierCurve(p0x,p0y,cp1x,cp2x,cp1y,cp2y,p2x,p2y);};this.addBezierCurve=function(p0x,p0y,p1x,p1y,p2x,p2y,p3x,p3y){var p0=[p0x,p0y],p1=[p1x,p1y],p2=[p2x,p2y],p3=[p3x,p3y];this.addPoint(p0[0],p0[1]);this.addPoint(p3[0],p3[1]);for(i=0;i<=1;i++){var f=function(t){return Math.pow(1-t,3)*p0[i]+3*Math.pow(1-t,2)*t*p1[i]+3*(1-t)*Math.pow(t,2)*p2[i]+Math.pow(t,3)*p3[i];};var b=6*p0[i]-12*p1[i]+6*p2[i];var a=-3*p0[i]+9*p1[i]-9*p2[i]+3*p3[i];var c=3*p1[i]-3*p0[i];if(a==0){if(b==0){continue;}var t=-c/b;if(0<t&&t<1){if(i==0){this.addX(f(t));}if(i==1){this.addY(f(t));}}continue;}var b2ac=Math.pow(b,2)-4*c*a;if(b2ac<0){continue;}var t1=(-b+Math.sqrt(b2ac))/(2*a);if(0<t1&&t1<1){if(i==0){this.addX(f(t1));}if(i==1){this.addY(f(t1));}}var t2=(-b-Math.sqrt(b2ac))/(2*a);if(0<t2&&t2<1){if(i==0){this.addX(f(t2));}if(i==1){this.addY(f(t2));}}}};this.isPointInBox=function(x,y){return(this.x1<=x&&x<=this.x2&&this.y1<=y&&y<=this.y2);};this.addPoint(x1,y1);this.addPoint(x2,y2);};svg.Transform=function(v){var that=this;this.Type={};this.Type.translate=function(s){this.p=svg.CreatePoint(s);this.apply=function(ctx){ctx.translate(this.p.x||0,this.p.y||0);};this.unapply=function(ctx){ctx.translate(-1*this.p.x||0,-1*this.p.y||0);};this.applyToPoint=function(p){p.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]);};};this.Type.rotate=function(s){var a=svg.ToNumberArray(s);this.angle=new svg.Property("angle",a[0]);this.cx=a[1]||0;this.cy=a[2]||0;this.apply=function(ctx){ctx.translate(this.cx,this.cy);ctx.rotate(this.angle.toRadians());ctx.translate(-this.cx,-this.cy);};this.unapply=function(ctx){ctx.translate(this.cx,this.cy);ctx.rotate(-1*this.angle.toRadians());ctx.translate(-this.cx,-this.cy);};this.applyToPoint=function(p){var a=this.angle.toRadians();p.applyTransform([1,0,0,1,this.p.x||0,this.p.y||0]);p.applyTransform([Math.cos(a),Math.sin(a),-Math.sin(a),Math.cos(a),0,0]);p.applyTransform([1,0,0,1,-this.p.x||0,-this.p.y||0]);};};this.Type.scale=function(s){this.p=svg.CreatePoint(s);this.apply=function(ctx){ctx.scale(this.p.x||1,this.p.y||this.p.x||1);};this.unapply=function(ctx){ctx.scale(1/this.p.x||1,1/this.p.y||this.p.x||1);};this.applyToPoint=function(p){p.applyTransform([this.p.x||0,0,0,this.p.y||0,0,0]);};};this.Type.matrix=function(s){this.m=svg.ToNumberArray(s);this.apply=function(ctx){ctx.transform(this.m[0],this.m[1],this.m[2],this.m[3],this.m[4],this.m[5]);};this.applyToPoint=function(p){p.applyTransform(this.m);};};this.Type.SkewBase=function(s){this.base=that.Type.matrix;this.base(s);this.angle=new svg.Property("angle",s);};this.Type.SkewBase.prototype=new this.Type.matrix;this.Type.skewX=function(s){this.base=that.Type.SkewBase;this.base(s);this.m=[1,0,Math.tan(this.angle.toRadians()),1,0,0];};this.Type.skewX.prototype=new this.Type.SkewBase;this.Type.skewY=function(s){this.base=that.Type.SkewBase;this.base(s);this.m=[1,Math.tan(this.angle.toRadians()),0,1,0,0];};this.Type.skewY.prototype=new this.Type.SkewBase;this.transforms=[];this.apply=function(ctx){for(var i=0;i<this.transforms.length;i++){this.transforms[i].apply(ctx);}};this.unapply=function(ctx){for(var i=this.transforms.length-1;i>=0;i--){this.transforms[i].unapply(ctx);}};this.applyToPoint=function(p){for(var i=0;i<this.transforms.length;i++){this.transforms[i].applyToPoint(p);}};var data=svg.trim(svg.compressSpaces(v)).replace(/\)(\s?,\s?)/g,") ").split(/\s(?=[a-z])/);for(var i=0;i<data.length;i++){var type=svg.trim(data[i].split("(")[0]);var s=data[i].split("(")[1].replace(")","");var transform=new this.Type[type](s);transform.type=type;this.transforms.push(transform);}};svg.AspectRatio=function(ctx,aspectRatio,width,desiredWidth,height,desiredHeight,minX,minY,refX,refY){aspectRatio=svg.compressSpaces(aspectRatio);aspectRatio=aspectRatio.replace(/^defer\s/,"");var align=aspectRatio.split(" ")[0]||"xMidYMid";var meetOrSlice=aspectRatio.split(" ")[1]||"meet";var scaleX=width/desiredWidth;var scaleY=height/desiredHeight;var scaleMin=Math.min(scaleX,scaleY);var scaleMax=Math.max(scaleX,scaleY);if(meetOrSlice=="meet"){desiredWidth*=scaleMin;desiredHeight*=scaleMin;}if(meetOrSlice=="slice"){desiredWidth*=scaleMax;desiredHeight*=scaleMax;}refX=new svg.Property("refX",refX);refY=new svg.Property("refY",refY);if(refX.hasValue()&&refY.hasValue()){ctx.translate(-scaleMin*refX.toPixels("x"),-scaleMin*refY.toPixels("y"));}else{if(align.match(/^xMid/)&&((meetOrSlice=="meet"&&scaleMin==scaleY)||(meetOrSlice=="slice"&&scaleMax==scaleY))){ctx.translate(width/2-desiredWidth/2,0);}if(align.match(/YMid$/)&&((meetOrSlice=="meet"&&scaleMin==scaleX)||(meetOrSlice=="slice"&&scaleMax==scaleX))){ctx.translate(0,height/2-desiredHeight/2);}if(align.match(/^xMax/)&&((meetOrSlice=="meet"&&scaleMin==scaleY)||(meetOrSlice=="slice"&&scaleMax==scaleY))){ctx.translate(width-desiredWidth,0);}if(align.match(/YMax$/)&&((meetOrSlice=="meet"&&scaleMin==scaleX)||(meetOrSlice=="slice"&&scaleMax==scaleX))){ctx.translate(0,height-desiredHeight);}}if(align=="none"){ctx.scale(scaleX,scaleY);}else{if(meetOrSlice=="meet"){ctx.scale(scaleMin,scaleMin);}else{if(meetOrSlice=="slice"){ctx.scale(scaleMax,scaleMax);}}}ctx.translate(minX==null?0:-minX,minY==null?0:-minY);};svg.Element={};svg.EmptyProperty=new svg.Property("EMPTY","");svg.Element.ElementBase=function(node){this.attributes={};this.styles={};this.children=[];this.attribute=function(name,createIfNotExists){var a=this.attributes[name];if(a!=null){return a;}if(createIfNotExists==true){a=new svg.Property(name,"");this.attributes[name]=a;}return a||svg.EmptyProperty;};this.getHrefAttribute=function(){for(var a in this.attributes){if(a.match(/:href$/)){return this.attributes[a];}}return svg.EmptyProperty;};this.style=function(name,createIfNotExists){var s=this.styles[name];if(s!=null){return s;}var a=this.attribute(name);if(a!=null&&a.hasValue()){this.styles[name]=a;return a;}var p=this.parent;if(p!=null){var ps=p.style(name);if(ps!=null&&ps.hasValue()){return ps;}}if(createIfNotExists==true){s=new svg.Property(name,"");this.styles[name]=s;}return s||svg.EmptyProperty;};this.render=function(ctx){if(this.style("display").value=="none"){return;}if(this.attribute("visibility").value=="hidden"){return;}ctx.save();if(this.attribute("mask").hasValue()){var mask=this.attribute("mask").getDefinition();if(mask!=null){mask.apply(ctx,this);}}else{if(this.style("filter").hasValue()){var filter=this.style("filter").getDefinition();if(filter!=null){filter.apply(ctx,this);}}else{this.setContext(ctx);this.renderChildren(ctx);this.clearContext(ctx);}}ctx.restore();};this.setContext=function(ctx){};this.clearContext=function(ctx){};this.renderChildren=function(ctx){for(var i=0;i<this.children.length;i++){this.children[i].render(ctx);}};this.addChild=function(childNode,create){var child=childNode;if(create){child=svg.CreateElement(childNode);}child.parent=this;this.children.push(child);};if(node!=null&&node.nodeType==1){for(var i=0;i<node.childNodes.length;i++){var childNode=node.childNodes[i];if(childNode.nodeType==1){this.addChild(childNode,true);}if(this.captureTextNodes&&childNode.nodeType==3){var text=childNode.nodeValue||childNode.text||"";if(svg.trim(svg.compressSpaces(text))!=""){this.addChild(new svg.Element.tspan(childNode),false);}}}for(var i=0;i<node.attributes.length;i++){var attribute=node.attributes[i];this.attributes[attribute.nodeName]=new svg.Property(attribute.nodeName,attribute.nodeValue);}var styles=svg.Styles[node.nodeName];if(styles!=null){for(var name in styles){this.styles[name]=styles[name];}}if(this.attribute("class").hasValue()){var classes=svg.compressSpaces(this.attribute("class").value).split(" ");for(var j=0;j<classes.length;j++){styles=svg.Styles["."+classes[j]];if(styles!=null){for(var name in styles){this.styles[name]=styles[name];}}styles=svg.Styles[node.nodeName+"."+classes[j]];if(styles!=null){for(var name in styles){this.styles[name]=styles[name];}}}}if(this.attribute("id").hasValue()){var styles=svg.Styles["#"+this.attribute("id").value];if(styles!=null){for(var name in styles){this.styles[name]=styles[name];}}}if(this.attribute("style").hasValue()){var styles=this.attribute("style").value.split(";");for(var i=0;i<styles.length;i++){if(svg.trim(styles[i])!=""){var style=styles[i].split(":");var name=svg.trim(style[0]);var value=svg.trim(style[1]);this.styles[name]=new svg.Property(name,value);}}}if(this.attribute("id").hasValue()){if(svg.Definitions[this.attribute("id").value]==null){svg.Definitions[this.attribute("id").value]=this;}}}};svg.Element.RenderedElementBase=function(node){this.base=svg.Element.ElementBase;this.base(node);this.setContext=function(ctx){if(this.style("fill").isUrlDefinition()){var fs=this.style("fill").getFillStyleDefinition(this,this.style("fill-opacity"));if(fs!=null){ctx.fillStyle=fs;}}else{if(this.style("fill").hasValue()){var fillStyle=this.style("fill");if(fillStyle.value=="currentColor"){fillStyle.value=this.style("color").value;}ctx.fillStyle=(fillStyle.value=="none"?"rgba(0,0,0,0)":fillStyle.value);}}if(this.style("fill-opacity").hasValue()){var fillStyle=new svg.Property("fill",ctx.fillStyle);fillStyle=fillStyle.addOpacity(this.style("fill-opacity").value);ctx.fillStyle=fillStyle.value;}if(this.style("stroke").isUrlDefinition()){var fs=this.style("stroke").getFillStyleDefinition(this,this.style("stroke-opacity"));if(fs!=null){ctx.strokeStyle=fs;}}else{if(this.style("stroke").hasValue()){var strokeStyle=this.style("stroke");if(strokeStyle.value=="currentColor"){strokeStyle.value=this.style("color").value;}ctx.strokeStyle=(strokeStyle.value=="none"?"rgba(0,0,0,0)":strokeStyle.value);}}if(this.style("stroke-opacity").hasValue()){var strokeStyle=new svg.Property("stroke",ctx.strokeStyle);strokeStyle=strokeStyle.addOpacity(this.style("stroke-opacity").value);ctx.strokeStyle=strokeStyle.value;}if(this.style("stroke-width").hasValue()){var newLineWidth=this.style("stroke-width").toPixels();ctx.lineWidth=newLineWidth==0?0.001:newLineWidth;}if(this.style("stroke-linecap").hasValue()){ctx.lineCap=this.style("stroke-linecap").value;}if(this.style("stroke-linejoin").hasValue()){ctx.lineJoin=this.style("stroke-linejoin").value;}if(this.style("stroke-miterlimit").hasValue()){ctx.miterLimit=this.style("stroke-miterlimit").value;}if(this.style("stroke-dasharray").hasValue()){var gaps=svg.ToNumberArray(this.style("stroke-dasharray").value);if(typeof(ctx.setLineDash)!="undefined"){ctx.setLineDash(gaps);}else{if(typeof(ctx.webkitLineDash)!="undefined"){ctx.webkitLineDash=gaps;}else{if(typeof(ctx.mozDash)!="undefined"){ctx.mozDash=gaps;}}}var offset=this.style("stroke-dashoffset").numValueOrDefault(1);if(typeof(ctx.lineDashOffset)!="undefined"){ctx.lineDashOffset=offset;}else{if(typeof(ctx.webkitLineDashOffset)!="undefined"){ctx.webkitLineDashOffset=offset;}else{if(typeof(ctx.mozDashOffset)!="undefined"){ctx.mozDashOffset=offset;}}}}if(typeof(ctx.font)!="undefined"){ctx.font=svg.Font.CreateFont(this.style("font-style").value,this.style("font-variant").value,this.style("font-weight").value,this.style("font-size").hasValue()?this.style("font-size").toPixels()+"px":"",this.style("font-family").value).toString();}if(this.attribute("transform").hasValue()){var transform=new svg.Transform(this.attribute("transform").value);transform.apply(ctx);}if(this.style("clip-path").hasValue()){var clip=this.style("clip-path").getDefinition();if(clip!=null){clip.apply(ctx);}}if(this.style("opacity").hasValue()){ctx.globalAlpha=this.style("opacity").numValue();}};};svg.Element.RenderedElementBase.prototype=new svg.Element.ElementBase;svg.Element.PathElementBase=function(node){this.base=svg.Element.RenderedElementBase;this.base(node);this.path=function(ctx){if(ctx!=null){ctx.beginPath();}return new svg.BoundingBox();};this.renderChildren=function(ctx){this.path(ctx);svg.Mouse.checkPath(this,ctx);if(ctx.fillStyle!=""){if(this.attribute("fill-rule").hasValue()){ctx.fill(this.attribute("fill-rule").value);}else{ctx.fill();}}if(ctx.strokeStyle!=""){ctx.stroke();}var markers=this.getMarkers();if(markers!=null){if(this.style("marker-start").isUrlDefinition()){var marker=this.style("marker-start").getDefinition();marker.render(ctx,markers[0][0],markers[0][1]);}if(this.style("marker-mid").isUrlDefinition()){var marker=this.style("marker-mid").getDefinition();for(var i=1;i<markers.length-1;i++){marker.render(ctx,markers[i][0],markers[i][1]);}}if(this.style("marker-end").isUrlDefinition()){var marker=this.style("marker-end").getDefinition();marker.render(ctx,markers[markers.length-1][0],markers[markers.length-1][1]);}}};this.getBoundingBox=function(){return this.path();};this.getMarkers=function(){return null;};};svg.Element.PathElementBase.prototype=new svg.Element.RenderedElementBase;svg.Element.svg=function(node){this.base=svg.Element.RenderedElementBase;this.base(node);this.baseClearContext=this.clearContext;this.clearContext=function(ctx){this.baseClearContext(ctx);svg.ViewPort.RemoveCurrent();};this.baseSetContext=this.setContext;this.setContext=function(ctx){ctx.strokeStyle="rgba(0,0,0,0)";ctx.lineCap="butt";ctx.lineJoin="miter";ctx.miterLimit=4;this.baseSetContext(ctx);if(!this.attribute("x").hasValue()){this.attribute("x",true).value=0;}if(!this.attribute("y").hasValue()){this.attribute("y",true).value=0;}ctx.translate(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"));var width=svg.ViewPort.width();var height=svg.ViewPort.height();if(!this.attribute("width").hasValue()){this.attribute("width",true).value="100%";}if(!this.attribute("height").hasValue()){this.attribute("height",true).value="100%";}if(typeof(this.root)=="undefined"){width=this.attribute("width").toPixels("x");height=this.attribute("height").toPixels("y");var x=0;var y=0;if(this.attribute("refX").hasValue()&&this.attribute("refY").hasValue()){x=-this.attribute("refX").toPixels("x");y=-this.attribute("refY").toPixels("y");}ctx.beginPath();ctx.moveTo(x,y);ctx.lineTo(width,y);ctx.lineTo(width,height);ctx.lineTo(x,height);ctx.closePath();ctx.clip();}svg.ViewPort.SetCurrent(width,height);if(this.attribute("viewBox").hasValue()){var viewBox=svg.ToNumberArray(this.attribute("viewBox").value);var minX=viewBox[0];var minY=viewBox[1];width=viewBox[2];height=viewBox[3];svg.AspectRatio(ctx,this.attribute("preserveAspectRatio").value,svg.ViewPort.width(),width,svg.ViewPort.height(),height,minX,minY,this.attribute("refX").value,this.attribute("refY").value);svg.ViewPort.RemoveCurrent();svg.ViewPort.SetCurrent(viewBox[2],viewBox[3]);}};};svg.Element.svg.prototype=new svg.Element.RenderedElementBase;svg.Element.rect=function(node){this.base=svg.Element.PathElementBase;this.base(node);this.path=function(ctx){var x=this.attribute("x").toPixels("x");var y=this.attribute("y").toPixels("y");var width=this.attribute("width").toPixels("x");var height=this.attribute("height").toPixels("y");var rx=this.attribute("rx").toPixels("x");var ry=this.attribute("ry").toPixels("y");if(this.attribute("rx").hasValue()&&!this.attribute("ry").hasValue()){ry=rx;}if(this.attribute("ry").hasValue()&&!this.attribute("rx").hasValue()){rx=ry;}rx=Math.min(rx,width/2);ry=Math.min(ry,height/2);if(ctx!=null){ctx.beginPath();ctx.moveTo(x+rx,y);ctx.lineTo(x+width-rx,y);ctx.quadraticCurveTo(x+width,y,x+width,y+ry);ctx.lineTo(x+width,y+height-ry);ctx.quadraticCurveTo(x+width,y+height,x+width-rx,y+height);ctx.lineTo(x+rx,y+height);ctx.quadraticCurveTo(x,y+height,x,y+height-ry);ctx.lineTo(x,y+ry);ctx.quadraticCurveTo(x,y,x+rx,y);ctx.closePath();}return new svg.BoundingBox(x,y,x+width,y+height);};};svg.Element.rect.prototype=new svg.Element.PathElementBase;svg.Element.circle=function(node){this.base=svg.Element.PathElementBase;this.base(node);this.path=function(ctx){var cx=this.attribute("cx").toPixels("x");var cy=this.attribute("cy").toPixels("y");var r=this.attribute("r").toPixels();if(ctx!=null){ctx.beginPath();ctx.arc(cx,cy,r,0,Math.PI*2,true);ctx.closePath();}return new svg.BoundingBox(cx-r,cy-r,cx+r,cy+r);};};svg.Element.circle.prototype=new svg.Element.PathElementBase;svg.Element.ellipse=function(node){this.base=svg.Element.PathElementBase;this.base(node);this.path=function(ctx){var KAPPA=4*((Math.sqrt(2)-1)/3);var rx=this.attribute("rx").toPixels("x");var ry=this.attribute("ry").toPixels("y");var cx=this.attribute("cx").toPixels("x");var cy=this.attribute("cy").toPixels("y");if(ctx!=null){ctx.beginPath();ctx.moveTo(cx,cy-ry);ctx.bezierCurveTo(cx+(KAPPA*rx),cy-ry,cx+rx,cy-(KAPPA*ry),cx+rx,cy);ctx.bezierCurveTo(cx+rx,cy+(KAPPA*ry),cx+(KAPPA*rx),cy+ry,cx,cy+ry);ctx.bezierCurveTo(cx-(KAPPA*rx),cy+ry,cx-rx,cy+(KAPPA*ry),cx-rx,cy);ctx.bezierCurveTo(cx-rx,cy-(KAPPA*ry),cx-(KAPPA*rx),cy-ry,cx,cy-ry);ctx.closePath();}return new svg.BoundingBox(cx-rx,cy-ry,cx+rx,cy+ry);};};svg.Element.ellipse.prototype=new svg.Element.PathElementBase;svg.Element.line=function(node){this.base=svg.Element.PathElementBase;this.base(node);this.getPoints=function(){return[new svg.Point(this.attribute("x1").toPixels("x"),this.attribute("y1").toPixels("y")),new svg.Point(this.attribute("x2").toPixels("x"),this.attribute("y2").toPixels("y"))];};this.path=function(ctx){var points=this.getPoints();if(ctx!=null){ctx.beginPath();ctx.moveTo(points[0].x,points[0].y);ctx.lineTo(points[1].x,points[1].y);}return new svg.BoundingBox(points[0].x,points[0].y,points[1].x,points[1].y);};this.getMarkers=function(){var points=this.getPoints();var a=points[0].angleTo(points[1]);return[[points[0],a],[points[1],a]];};};svg.Element.line.prototype=new svg.Element.PathElementBase;svg.Element.polyline=function(node){this.base=svg.Element.PathElementBase;this.base(node);this.points=svg.CreatePath(this.attribute("points").value);this.path=function(ctx){var bb=new svg.BoundingBox(this.points[0].x,this.points[0].y);if(ctx!=null){ctx.beginPath();ctx.moveTo(this.points[0].x,this.points[0].y);}for(var i=1;i<this.points.length;i++){bb.addPoint(this.points[i].x,this.points[i].y);if(ctx!=null){ctx.lineTo(this.points[i].x,this.points[i].y);}}return bb;};this.getMarkers=function(){var markers=[];for(var i=0;i<this.points.length-1;i++){markers.push([this.points[i],this.points[i].angleTo(this.points[i+1])]);}markers.push([this.points[this.points.length-1],markers[markers.length-1][1]]);return markers;};};svg.Element.polyline.prototype=new svg.Element.PathElementBase;svg.Element.polygon=function(node){this.base=svg.Element.polyline;this.base(node);this.basePath=this.path;this.path=function(ctx){var bb=this.basePath(ctx);if(ctx!=null){ctx.lineTo(this.points[0].x,this.points[0].y);ctx.closePath();}return bb;};};svg.Element.polygon.prototype=new svg.Element.polyline;svg.Element.path=function(node){this.base=svg.Element.PathElementBase;this.base(node);var d=this.attribute("d").value;d=d.replace(/,/gm," ");d=d.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2");d=d.replace(/([MmZzLlHhVvCcSsQqTtAa])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2");d=d.replace(/([MmZzLlHhVvCcSsQqTtAa])([^\s])/gm,"$1 $2");d=d.replace(/([^\s])([MmZzLlHhVvCcSsQqTtAa])/gm,"$1 $2");d=d.replace(/([0-9])([+\-])/gm,"$1 $2");d=d.replace(/(\.[0-9]*)(\.)/gm,"$1 $2");d=d.replace(/([Aa](\s+[0-9]+){3})\s+([01])\s*([01])/gm,"$1 $3 $4 ");d=svg.compressSpaces(d);d=svg.trim(d);this.PathParser=new (function(d){this.tokens=d.split(" ");this.reset=function(){this.i=-1;this.command="";this.previousCommand="";this.start=new svg.Point(0,0);this.control=new svg.Point(0,0);this.current=new svg.Point(0,0);this.points=[];this.angles=[];};this.isEnd=function(){return this.i>=this.tokens.length-1;};this.isCommandOrEnd=function(){if(this.isEnd()){return true;}return this.tokens[this.i+1].match(/^[A-Za-z]$/)!=null;};this.isRelativeCommand=function(){switch(this.command){case"m":case"l":case"h":case"v":case"c":case"s":case"q":case"t":case"a":case"z":return true;break;}return false;};this.getToken=function(){this.i++;return this.tokens[this.i];};this.getScalar=function(){return parseFloat(this.getToken());};this.nextCommand=function(){this.previousCommand=this.command;this.command=this.getToken();};this.getPoint=function(){var p=new svg.Point(this.getScalar(),this.getScalar());return this.makeAbsolute(p);};this.getAsControlPoint=function(){var p=this.getPoint();this.control=p;return p;};this.getAsCurrentPoint=function(){var p=this.getPoint();this.current=p;return p;};this.getReflectedControlPoint=function(){if(this.previousCommand.toLowerCase()!="c"&&this.previousCommand.toLowerCase()!="s"&&this.previousCommand.toLowerCase()!="q"&&this.previousCommand.toLowerCase()!="t"){return this.current;}var p=new svg.Point(2*this.current.x-this.control.x,2*this.current.y-this.control.y);return p;};this.makeAbsolute=function(p){if(this.isRelativeCommand()){p.x+=this.current.x;p.y+=this.current.y;}return p;};this.addMarker=function(p,from,priorTo){if(priorTo!=null&&this.angles.length>0&&this.angles[this.angles.length-1]==null){this.angles[this.angles.length-1]=this.points[this.points.length-1].angleTo(priorTo);}this.addMarkerAngle(p,from==null?null:from.angleTo(p));};this.addMarkerAngle=function(p,a){this.points.push(p);this.angles.push(a);};this.getMarkerPoints=function(){return this.points;};this.getMarkerAngles=function(){for(var i=0;i<this.angles.length;i++){if(this.angles[i]==null){for(var j=i+1;j<this.angles.length;j++){if(this.angles[j]!=null){this.angles[i]=this.angles[j];break;}}}}return this.angles;};})(d);this.path=function(ctx){var pp=this.PathParser;pp.reset();var bb=new svg.BoundingBox();if(ctx!=null){ctx.beginPath();}while(!pp.isEnd()){pp.nextCommand();switch(pp.command){case"M":case"m":var p=pp.getAsCurrentPoint();pp.addMarker(p);bb.addPoint(p.x,p.y);if(ctx!=null){ctx.moveTo(p.x,p.y);}pp.start=pp.current;while(!pp.isCommandOrEnd()){var p=pp.getAsCurrentPoint();pp.addMarker(p,pp.start);bb.addPoint(p.x,p.y);if(ctx!=null){ctx.lineTo(p.x,p.y);}}break;case"L":case"l":while(!pp.isCommandOrEnd()){var c=pp.current;var p=pp.getAsCurrentPoint();pp.addMarker(p,c);bb.addPoint(p.x,p.y);if(ctx!=null){ctx.lineTo(p.x,p.y);}}break;case"H":case"h":while(!pp.isCommandOrEnd()){var newP=new svg.Point((pp.isRelativeCommand()?pp.current.x:0)+pp.getScalar(),pp.current.y);pp.addMarker(newP,pp.current);pp.current=newP;bb.addPoint(pp.current.x,pp.current.y);if(ctx!=null){ctx.lineTo(pp.current.x,pp.current.y);}}break;case"V":case"v":while(!pp.isCommandOrEnd()){var newP=new svg.Point(pp.current.x,(pp.isRelativeCommand()?pp.current.y:0)+pp.getScalar());pp.addMarker(newP,pp.current);pp.current=newP;bb.addPoint(pp.current.x,pp.current.y);if(ctx!=null){ctx.lineTo(pp.current.x,pp.current.y);}}break;case"C":case"c":while(!pp.isCommandOrEnd()){var curr=pp.current;var p1=pp.getPoint();var cntrl=pp.getAsControlPoint();var cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,p1);bb.addBezierCurve(curr.x,curr.y,p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y);if(ctx!=null){ctx.bezierCurveTo(p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y);}}break;case"S":case"s":while(!pp.isCommandOrEnd()){var curr=pp.current;var p1=pp.getReflectedControlPoint();var cntrl=pp.getAsControlPoint();var cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,p1);bb.addBezierCurve(curr.x,curr.y,p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y);if(ctx!=null){ctx.bezierCurveTo(p1.x,p1.y,cntrl.x,cntrl.y,cp.x,cp.y);}}break;case"Q":case"q":while(!pp.isCommandOrEnd()){var curr=pp.current;var cntrl=pp.getAsControlPoint();var cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,cntrl);bb.addQuadraticCurve(curr.x,curr.y,cntrl.x,cntrl.y,cp.x,cp.y);if(ctx!=null){ctx.quadraticCurveTo(cntrl.x,cntrl.y,cp.x,cp.y);}}break;case"T":case"t":while(!pp.isCommandOrEnd()){var curr=pp.current;var cntrl=pp.getReflectedControlPoint();pp.control=cntrl;var cp=pp.getAsCurrentPoint();pp.addMarker(cp,cntrl,cntrl);bb.addQuadraticCurve(curr.x,curr.y,cntrl.x,cntrl.y,cp.x,cp.y);if(ctx!=null){ctx.quadraticCurveTo(cntrl.x,cntrl.y,cp.x,cp.y);}}break;case"A":case"a":while(!pp.isCommandOrEnd()){var curr=pp.current;var rx=pp.getScalar();var ry=pp.getScalar();var xAxisRotation=pp.getScalar()*(Math.PI/180);var largeArcFlag=pp.getScalar();var sweepFlag=pp.getScalar();var cp=pp.getAsCurrentPoint();var currp=new svg.Point(Math.cos(xAxisRotation)*(curr.x-cp.x)/2+Math.sin(xAxisRotation)*(curr.y-cp.y)/2,-Math.sin(xAxisRotation)*(curr.x-cp.x)/2+Math.cos(xAxisRotation)*(curr.y-cp.y)/2);var l=Math.pow(currp.x,2)/Math.pow(rx,2)+Math.pow(currp.y,2)/Math.pow(ry,2);if(l>1){rx*=Math.sqrt(l);ry*=Math.sqrt(l);}var s=(largeArcFlag==sweepFlag?-1:1)*Math.sqrt(((Math.pow(rx,2)*Math.pow(ry,2))-(Math.pow(rx,2)*Math.pow(currp.y,2))-(Math.pow(ry,2)*Math.pow(currp.x,2)))/(Math.pow(rx,2)*Math.pow(currp.y,2)+Math.pow(ry,2)*Math.pow(currp.x,2)));if(isNaN(s)){s=0;}var cpp=new svg.Point(s*rx*currp.y/ry,s*-ry*currp.x/rx);var centp=new svg.Point((curr.x+cp.x)/2+Math.cos(xAxisRotation)*cpp.x-Math.sin(xAxisRotation)*cpp.y,(curr.y+cp.y)/2+Math.sin(xAxisRotation)*cpp.x+Math.cos(xAxisRotation)*cpp.y);var m=function(v){return Math.sqrt(Math.pow(v[0],2)+Math.pow(v[1],2));};var r=function(u,v){return(u[0]*v[0]+u[1]*v[1])/(m(u)*m(v));};var a=function(u,v){return(u[0]*v[1]<u[1]*v[0]?-1:1)*Math.acos(r(u,v));};var a1=a([1,0],[(currp.x-cpp.x)/rx,(currp.y-cpp.y)/ry]);var u=[(currp.x-cpp.x)/rx,(currp.y-cpp.y)/ry];var v=[(-currp.x-cpp.x)/rx,(-currp.y-cpp.y)/ry];var ad=a(u,v);if(r(u,v)<=-1){ad=Math.PI;}if(r(u,v)>=1){ad=0;}var dir=1-sweepFlag?1:-1;var ah=a1+dir*(ad/2);var halfWay=new svg.Point(centp.x+rx*Math.cos(ah),centp.y+ry*Math.sin(ah));pp.addMarkerAngle(halfWay,ah-dir*Math.PI/2);pp.addMarkerAngle(cp,ah-dir*Math.PI);bb.addPoint(cp.x,cp.y);if(ctx!=null){var r=rx>ry?rx:ry;var sx=rx>ry?1:rx/ry;var sy=rx>ry?ry/rx:1;ctx.translate(centp.x,centp.y);ctx.rotate(xAxisRotation);ctx.scale(sx,sy);ctx.arc(0,0,r,a1,a1+ad,1-sweepFlag);ctx.scale(1/sx,1/sy);ctx.rotate(-xAxisRotation);ctx.translate(-centp.x,-centp.y);}}break;case"Z":case"z":if(ctx!=null){ctx.closePath();}pp.current=pp.start;}}return bb;};this.getMarkers=function(){var points=this.PathParser.getMarkerPoints();var angles=this.PathParser.getMarkerAngles();var markers=[];for(var i=0;i<points.length;i++){markers.push([points[i],angles[i]]);}return markers;};};svg.Element.path.prototype=new svg.Element.PathElementBase;svg.Element.pattern=function(node){this.base=svg.Element.ElementBase;this.base(node);this.createPattern=function(ctx,element){var width=this.attribute("width").toPixels("x",true);var height=this.attribute("height").toPixels("y",true);var tempSvg=new svg.Element.svg();tempSvg.attributes["viewBox"]=new svg.Property("viewBox",this.attribute("viewBox").value);tempSvg.attributes["width"]=new svg.Property("width",width+"px");tempSvg.attributes["height"]=new svg.Property("height",height+"px");tempSvg.attributes["transform"]=new svg.Property("transform",this.attribute("patternTransform").value);tempSvg.children=this.children;var c=document.createElement("canvas");c.width=width;c.height=height;var cctx=c.getContext("2d");if(this.attribute("x").hasValue()&&this.attribute("y").hasValue()){cctx.translate(this.attribute("x").toPixels("x",true),this.attribute("y").toPixels("y",true));}for(var x=-1;x<=1;x++){for(var y=-1;y<=1;y++){cctx.save();cctx.translate(x*c.width,y*c.height);tempSvg.render(cctx);cctx.restore();}}var pattern=ctx.createPattern(c,"repeat");return pattern;};};svg.Element.pattern.prototype=new svg.Element.ElementBase;svg.Element.marker=function(node){this.base=svg.Element.ElementBase;this.base(node);this.baseRender=this.render;this.render=function(ctx,point,angle){ctx.translate(point.x,point.y);if(this.attribute("orient").valueOrDefault("auto")=="auto"){ctx.rotate(angle);}if(this.attribute("markerUnits").valueOrDefault("strokeWidth")=="strokeWidth"){ctx.scale(ctx.lineWidth,ctx.lineWidth);}ctx.save();var tempSvg=new svg.Element.svg();tempSvg.attributes["viewBox"]=new svg.Property("viewBox",this.attribute("viewBox").value);tempSvg.attributes["refX"]=new svg.Property("refX",this.attribute("refX").value);tempSvg.attributes["refY"]=new svg.Property("refY",this.attribute("refY").value);tempSvg.attributes["width"]=new svg.Property("width",this.attribute("markerWidth").value);tempSvg.attributes["height"]=new svg.Property("height",this.attribute("markerHeight").value);tempSvg.attributes["fill"]=new svg.Property("fill",this.attribute("fill").valueOrDefault("black"));tempSvg.attributes["stroke"]=new svg.Property("stroke",this.attribute("stroke").valueOrDefault("none"));tempSvg.children=this.children;tempSvg.render(ctx);ctx.restore();if(this.attribute("markerUnits").valueOrDefault("strokeWidth")=="strokeWidth"){ctx.scale(1/ctx.lineWidth,1/ctx.lineWidth);}if(this.attribute("orient").valueOrDefault("auto")=="auto"){ctx.rotate(-angle);}ctx.translate(-point.x,-point.y);};};svg.Element.marker.prototype=new svg.Element.ElementBase;svg.Element.defs=function(node){this.base=svg.Element.ElementBase;this.base(node);this.render=function(ctx){};};svg.Element.defs.prototype=new svg.Element.ElementBase;svg.Element.GradientBase=function(node){this.base=svg.Element.ElementBase;this.base(node);this.gradientUnits=this.attribute("gradientUnits").valueOrDefault("objectBoundingBox");this.stops=[];for(var i=0;i<this.children.length;i++){var child=this.children[i];if(child.type=="stop"){this.stops.push(child);}}this.getGradient=function(){};this.createGradient=function(ctx,element,parentOpacityProp){var stopsContainer=this;if(this.getHrefAttribute().hasValue()){stopsContainer=this.getHrefAttribute().getDefinition();}var addParentOpacity=function(color){if(parentOpacityProp.hasValue()){var p=new svg.Property("color",color);return p.addOpacity(parentOpacityProp.value).value;}return color;};var g=this.getGradient(ctx,element);if(g==null){return addParentOpacity(stopsContainer.stops[stopsContainer.stops.length-1].color);}for(var i=0;i<stopsContainer.stops.length;i++){g.addColorStop(stopsContainer.stops[i].offset,addParentOpacity(stopsContainer.stops[i].color));}if(this.attribute("gradientTransform").hasValue()){var rootView=svg.ViewPort.viewPorts[0];var rect=new svg.Element.rect();rect.attributes["x"]=new svg.Property("x",-svg.MAX_VIRTUAL_PIXELS/3);rect.attributes["y"]=new svg.Property("y",-svg.MAX_VIRTUAL_PIXELS/3);rect.attributes["width"]=new svg.Property("width",svg.MAX_VIRTUAL_PIXELS);rect.attributes["height"]=new svg.Property("height",svg.MAX_VIRTUAL_PIXELS);var group=new svg.Element.g();group.attributes["transform"]=new svg.Property("transform",this.attribute("gradientTransform").value);group.children=[rect];var tempSvg=new svg.Element.svg();tempSvg.attributes["x"]=new svg.Property("x",0);tempSvg.attributes["y"]=new svg.Property("y",0);tempSvg.attributes["width"]=new svg.Property("width",rootView.width);tempSvg.attributes["height"]=new svg.Property("height",rootView.height);tempSvg.children=[group];var c=document.createElement("canvas");c.width=rootView.width;c.height=rootView.height;var tempCtx=c.getContext("2d");tempCtx.fillStyle=g;tempSvg.render(tempCtx);return tempCtx.createPattern(c,"no-repeat");}return g;};};svg.Element.GradientBase.prototype=new svg.Element.ElementBase;svg.Element.linearGradient=function(node){this.base=svg.Element.GradientBase;this.base(node);this.getGradient=function(ctx,element){var bb=element.getBoundingBox();if(!this.attribute("x1").hasValue()&&!this.attribute("y1").hasValue()&&!this.attribute("x2").hasValue()&&!this.attribute("y2").hasValue()){this.attribute("x1",true).value=0;this.attribute("y1",true).value=0;this.attribute("x2",true).value=1;this.attribute("y2",true).value=0;}var x1=(this.gradientUnits=="objectBoundingBox"?bb.x()+bb.width()*this.attribute("x1").numValue():this.attribute("x1").toPixels("x"));var y1=(this.gradientUnits=="objectBoundingBox"?bb.y()+bb.height()*this.attribute("y1").numValue():this.attribute("y1").toPixels("y"));var x2=(this.gradientUnits=="objectBoundingBox"?bb.x()+bb.width()*this.attribute("x2").numValue():this.attribute("x2").toPixels("x"));var y2=(this.gradientUnits=="objectBoundingBox"?bb.y()+bb.height()*this.attribute("y2").numValue():this.attribute("y2").toPixels("y"));if(x1==x2&&y1==y2){return null;}return ctx.createLinearGradient(x1,y1,x2,y2);};};svg.Element.linearGradient.prototype=new svg.Element.GradientBase;svg.Element.radialGradient=function(node){this.base=svg.Element.GradientBase;this.base(node);this.getGradient=function(ctx,element){var bb=element.getBoundingBox();if(!this.attribute("cx").hasValue()){this.attribute("cx",true).value="50%";}if(!this.attribute("cy").hasValue()){this.attribute("cy",true).value="50%";}if(!this.attribute("r").hasValue()){this.attribute("r",true).value="50%";}var cx=(this.gradientUnits=="objectBoundingBox"?bb.x()+bb.width()*this.attribute("cx").numValue():this.attribute("cx").toPixels("x"));var cy=(this.gradientUnits=="objectBoundingBox"?bb.y()+bb.height()*this.attribute("cy").numValue():this.attribute("cy").toPixels("y"));var fx=cx;var fy=cy;if(this.attribute("fx").hasValue()){fx=(this.gradientUnits=="objectBoundingBox"?bb.x()+bb.width()*this.attribute("fx").numValue():this.attribute("fx").toPixels("x"));}if(this.attribute("fy").hasValue()){fy=(this.gradientUnits=="objectBoundingBox"?bb.y()+bb.height()*this.attribute("fy").numValue():this.attribute("fy").toPixels("y"));}var r=(this.gradientUnits=="objectBoundingBox"?(bb.width()+bb.height())/2*this.attribute("r").numValue():this.attribute("r").toPixels());return ctx.createRadialGradient(fx,fy,0,cx,cy,r);};};svg.Element.radialGradient.prototype=new svg.Element.GradientBase;svg.Element.stop=function(node){this.base=svg.Element.ElementBase;this.base(node);this.offset=this.attribute("offset").numValue();if(this.offset<0){this.offset=0;}if(this.offset>1){this.offset=1;}var stopColor=this.style("stop-color");if(this.style("stop-opacity").hasValue()){stopColor=stopColor.addOpacity(this.style("stop-opacity").value);}this.color=stopColor.value;};svg.Element.stop.prototype=new svg.Element.ElementBase;svg.Element.AnimateBase=function(node){this.base=svg.Element.ElementBase;this.base(node);svg.Animations.push(this);this.duration=0;this.begin=this.attribute("begin").toMilliseconds();this.maxDuration=this.begin+this.attribute("dur").toMilliseconds();this.getProperty=function(){var attributeType=this.attribute("attributeType").value;var attributeName=this.attribute("attributeName").value;if(attributeType=="CSS"){return this.parent.style(attributeName,true);}return this.parent.attribute(attributeName,true);};this.initialValue=null;this.initialUnits="";this.removed=false;this.calcValue=function(){return"";};this.update=function(delta){if(this.initialValue==null){this.initialValue=this.getProperty().value;this.initialUnits=this.getProperty().getUnits();}if(this.duration>this.maxDuration){if(this.attribute("repeatCount").value=="indefinite"||this.attribute("repeatDur").value=="indefinite"){this.duration=0;}else{if(this.attribute("fill").valueOrDefault("remove")=="remove"&&!this.removed){this.removed=true;this.getProperty().value=this.initialValue;return true;}else{return false;}}}this.duration=this.duration+delta;var updated=false;if(this.begin<this.duration){var newValue=this.calcValue();if(this.attribute("type").hasValue()){var type=this.attribute("type").value;newValue=type+"("+newValue+")";}this.getProperty().value=newValue;updated=true;}return updated;};this.from=this.attribute("from");this.to=this.attribute("to");this.values=this.attribute("values");if(this.values.hasValue()){this.values.value=this.values.value.split(";");}this.progress=function(){var ret={progress:(this.duration-this.begin)/(this.maxDuration-this.begin)};if(this.values.hasValue()){var p=ret.progress*(this.values.value.length-1);var lb=Math.floor(p),ub=Math.ceil(p);ret.from=new svg.Property("from",parseFloat(this.values.value[lb]));ret.to=new svg.Property("to",parseFloat(this.values.value[ub]));ret.progress=(p-lb)/(ub-lb);}else{ret.from=this.from;ret.to=this.to;}return ret;};};svg.Element.AnimateBase.prototype=new svg.Element.ElementBase;svg.Element.animate=function(node){this.base=svg.Element.AnimateBase;this.base(node);this.calcValue=function(){var p=this.progress();var newValue=p.from.numValue()+(p.to.numValue()-p.from.numValue())*p.progress;return newValue+this.initialUnits;};};svg.Element.animate.prototype=new svg.Element.AnimateBase;svg.Element.animateColor=function(node){this.base=svg.Element.AnimateBase;this.base(node);this.calcValue=function(){var p=this.progress();var from=new RGBColor(p.from.value);var to=new RGBColor(p.to.value);if(from.ok&&to.ok){var r=from.r+(to.r-from.r)*p.progress;var g=from.g+(to.g-from.g)*p.progress;var b=from.b+(to.b-from.b)*p.progress;return"rgb("+parseInt(r,10)+","+parseInt(g,10)+","+parseInt(b,10)+")";}return this.attribute("from").value;};};svg.Element.animateColor.prototype=new svg.Element.AnimateBase;svg.Element.animateTransform=function(node){this.base=svg.Element.AnimateBase;this.base(node);this.calcValue=function(){var p=this.progress();var from=svg.ToNumberArray(p.from.value);var to=svg.ToNumberArray(p.to.value);var newValue="";for(var i=0;i<from.length;i++){newValue+=from[i]+(to[i]-from[i])*p.progress+" ";}return newValue;};};svg.Element.animateTransform.prototype=new svg.Element.animate;svg.Element.font=function(node){this.base=svg.Element.ElementBase;this.base(node);this.horizAdvX=this.attribute("horiz-adv-x").numValue();this.isRTL=false;this.isArabic=false;this.fontFace=null;this.missingGlyph=null;this.glyphs=[];for(var i=0;i<this.children.length;i++){var child=this.children[i];if(child.type=="font-face"){this.fontFace=child;if(child.style("font-family").hasValue()){svg.Definitions[child.style("font-family").value]=this;}}else{if(child.type=="missing-glyph"){this.missingGlyph=child;}else{if(child.type=="glyph"){if(child.arabicForm!=""){this.isRTL=true;this.isArabic=true;if(typeof(this.glyphs[child.unicode])=="undefined"){this.glyphs[child.unicode]=[];}this.glyphs[child.unicode][child.arabicForm]=child;}else{this.glyphs[child.unicode]=child;}}}}}};svg.Element.font.prototype=new svg.Element.ElementBase;svg.Element.fontface=function(node){this.base=svg.Element.ElementBase;this.base(node);this.ascent=this.attribute("ascent").value;this.descent=this.attribute("descent").value;this.unitsPerEm=this.attribute("units-per-em").numValue();};svg.Element.fontface.prototype=new svg.Element.ElementBase;svg.Element.missingglyph=function(node){this.base=svg.Element.path;this.base(node);this.horizAdvX=0;};svg.Element.missingglyph.prototype=new svg.Element.path;svg.Element.glyph=function(node){this.base=svg.Element.path;this.base(node);this.horizAdvX=this.attribute("horiz-adv-x").numValue();this.unicode=this.attribute("unicode").value;this.arabicForm=this.attribute("arabic-form").value;};svg.Element.glyph.prototype=new svg.Element.path;svg.Element.text=function(node){this.captureTextNodes=true;this.base=svg.Element.RenderedElementBase;this.base(node);this.baseSetContext=this.setContext;this.setContext=function(ctx){this.baseSetContext(ctx);if(this.style("dominant-baseline").hasValue()){ctx.textBaseline=this.style("dominant-baseline").value;}if(this.style("alignment-baseline").hasValue()){ctx.textBaseline=this.style("alignment-baseline").value;}};this.getBoundingBox=function(){return new svg.BoundingBox(this.attribute("x").toPixels("x"),this.attribute("y").toPixels("y"),0,0);};this.renderChildren=function(ctx){this.x=this.attribute("x").toPixels("x");this.y=this.attribute("y").toPixels("y");this.x+=this.getAnchorDelta(ctx,this,0);for(var i=0;i<this.children.length;i++){this.renderChild(ctx,this,i);}};this.getAnchorDelta=function(ctx,parent,startI){var textAnchor=this.style("text-anchor").valueOrDefault("start");if(textAnchor!="start"){var width=0;for(var i=startI;i<parent.children.length;i++){var child=parent.children[i];if(i>startI&&child.attribute("x").hasValue()){break;}width+=child.measureTextRecursive(ctx);}return -1*(textAnchor=="end"?width:width/2);}return 0;};this.renderChild=function(ctx,parent,i){var child=parent.children[i];if(child.attribute("x").hasValue()){child.x=child.attribute("x").toPixels("x")+this.getAnchorDelta(ctx,parent,i);}else{if(this.attribute("dx").hasValue()){this.x+=this.attribute("dx").toPixels("x");}if(child.attribute("dx").hasValue()){this.x+=child.attribute("dx").toPixels("x");}child.x=this.x;}this.x=child.x+child.measureText(ctx);if(child.attribute("y").hasValue()){child.y=child.attribute("y").toPixels("y");}else{if(this.attribute("dy").hasValue()){this.y+=this.attribute("dy").toPixels("y");}if(child.attribute("dy").hasValue()){this.y+=child.attribute("dy").toPixels("y");}child.y=this.y;}this.y=child.y;child.render(ctx);for(var i=0;i<child.children.length;i++){this.renderChild(ctx,child,i);}};};svg.Element.text.prototype=new svg.Element.RenderedElementBase;svg.Element.TextElementBase=function(node){this.base=svg.Element.RenderedElementBase;this.base(node);this.getGlyph=function(font,text,i){var c=text[i];var glyph=null;if(font.isArabic){var arabicForm="isolated";if((i==0||text[i-1]==" ")&&i<text.length-2&&text[i+1]!=" "){arabicForm="terminal";}if(i>0&&text[i-1]!=" "&&i<text.length-2&&text[i+1]!=" "){arabicForm="medial";}if(i>0&&text[i-1]!=" "&&(i==text.length-1||text[i+1]==" ")){arabicForm="initial";}if(typeof(font.glyphs[c])!="undefined"){glyph=font.glyphs[c][arabicForm];if(glyph==null&&font.glyphs[c].type=="glyph"){glyph=font.glyphs[c];}}}else{glyph=font.glyphs[c];}if(glyph==null){glyph=font.missingGlyph;}return glyph;};this.renderChildren=function(ctx){var customFont=this.parent.style("font-family").getDefinition();if(customFont!=null){var fontSize=this.parent.style("font-size").numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize);var fontStyle=this.parent.style("font-style").valueOrDefault(svg.Font.Parse(svg.ctx.font).fontStyle);var text=this.getText();if(customFont.isRTL){text=text.split("").reverse().join("");}var dx=svg.ToNumberArray(this.parent.attribute("dx").value);for(var i=0;i<text.length;i++){var glyph=this.getGlyph(customFont,text,i);var scale=fontSize/customFont.fontFace.unitsPerEm;ctx.translate(this.x,this.y);ctx.scale(scale,-scale);var lw=ctx.lineWidth;ctx.lineWidth=ctx.lineWidth*customFont.fontFace.unitsPerEm/fontSize;if(fontStyle=="italic"){ctx.transform(1,0,0.4,1,0,0);}glyph.render(ctx);if(fontStyle=="italic"){ctx.transform(1,0,-0.4,1,0,0);}ctx.lineWidth=lw;ctx.scale(1/scale,-1/scale);ctx.translate(-this.x,-this.y);this.x+=fontSize*(glyph.horizAdvX||customFont.horizAdvX)/customFont.fontFace.unitsPerEm;if(typeof(dx[i])!="undefined"&&!isNaN(dx[i])){this.x+=dx[i];}}return;}if(ctx.fillStyle!=""){ctx.fillText(svg.compressSpaces(this.getText()),this.x,this.y);}if(ctx.strokeStyle!=""){ctx.strokeText(svg.compressSpaces(this.getText()),this.x,this.y);}};this.getText=function(){};this.measureTextRecursive=function(ctx){var width=this.measureText(ctx);for(var i=0;i<this.children.length;i++){width+=this.children[i].measureTextRecursive(ctx);}return width;};this.measureText=function(ctx){var customFont=this.parent.style("font-family").getDefinition();if(customFont!=null){var fontSize=this.parent.style("font-size").numValueOrDefault(svg.Font.Parse(svg.ctx.font).fontSize);var measure=0;var text=this.getText();if(customFont.isRTL){text=text.split("").reverse().join("");}var dx=svg.ToNumberArray(this.parent.attribute("dx").value);for(var i=0;i<text.length;i++){var glyph=this.getGlyph(customFont,text,i);measure+=(glyph.horizAdvX||customFont.horizAdvX)*fontSize/customFont.fontFace.unitsPerEm;if(typeof(dx[i])!="undefined"&&!isNaN(dx[i])){measure+=dx[i];}}return measure;}var textToMeasure=svg.compressSpaces(this.getText());if(!ctx.measureText){return textToMeasure.length*10;}ctx.save();this.setContext(ctx);var width=ctx.measureText(textToMeasure).width;ctx.restore();return width;};};svg.Element.TextElementBase.prototype=new svg.Element.RenderedElementBase;svg.Element.tspan=function(node){this.captureTextNodes=true;this.base=svg.Element.TextElementBase;this.base(node);this.text=node.nodeValue||node.text||"";this.getText=function(){return this.text;};};svg.Element.tspan.prototype=new svg.Element.TextElementBase;svg.Element.tref=function(node){this.base=svg.Element.TextElementBase;this.base(node);this.getText=function(){var element=this.getHrefAttribute().getDefinition();if(element!=null){return element.children[0].getText();}};};svg.Element.tref.prototype=new svg.Element.TextElementBase;svg.Element.a=function(node){this.base=svg.Element.TextElementBase;this.base(node);this.hasText=true;for(var i=0;i<node.childNodes.length;i++){if(node.childNodes[i].nodeType!=3){this.hasText=false;}}this.text=this.hasText?node.childNodes[0].nodeValue:"";this.getText=function(){return this.text;};this.baseRenderChildren=this.renderChildren;this.renderChildren=function(ctx){if(this.hasText){this.baseRenderChildren(ctx);var fontSize=new svg.Property("fontSize",svg.Font.Parse(svg.ctx.font).fontSize);svg.Mouse.checkBoundingBox(this,new svg.BoundingBox(this.x,this.y-fontSize.toPixels("y"),this.x+this.measureText(ctx),this.y));}else{var g=new svg.Element.g();g.children=this.children;g.parent=this;g.render(ctx);}};this.onclick=function(){window.open(this.getHrefAttribute().value);};this.onmousemove=function(){svg.ctx.canvas.style.cursor="pointer";};};svg.Element.a.prototype=new svg.Element.TextElementBase;svg.Element.image=function(node){this.base=svg.Element.RenderedElementBase;this.base(node);var href=this.getHrefAttribute().value;var isSvg=href.match(/\.svg$/);svg.Images.push(this);this.loaded=false;if(!isSvg){this.img=document.createElement("img");var self=this;this.img.onload=function(){self.loaded=true;};this.img.onerror=function(){if(typeof(console)!="undefined"){console.log('ERROR: image "'+href+'" not found');self.loaded=true;}};this.img.src=href;}else{this.img=svg.ajax(href);this.loaded=true;}this.renderChildren=function(ctx){var x=this.attribute("x").toPixels("x");var y=this.attribute("y").toPixels("y");var width=this.attribute("width").toPixels("x");var height=this.attribute("height").toPixels("y");if(width==0||height==0){return;}ctx.save();if(isSvg){ctx.drawSvg(this.img,x,y,width,height);}else{ctx.translate(x,y);svg.AspectRatio(ctx,this.attribute("preserveAspectRatio").value,width,this.img.width,height,this.img.height,0,0);ctx.drawImage(this.img,0,0);}ctx.restore();};this.getBoundingBox=function(){var x=this.attribute("x").toPixels("x");var y=this.attribute("y").toPixels("y");var width=this.attribute("width").toPixels("x");var height=this.attribute("height").toPixels("y");return new svg.BoundingBox(x,y,x+width,y+height);};};svg.Element.image.prototype=new svg.Element.RenderedElementBase;svg.Element.g=function(node){this.base=svg.Element.RenderedElementBase;this.base(node);this.getBoundingBox=function(){var bb=new svg.BoundingBox();for(var i=0;i<this.children.length;i++){bb.addBoundingBox(this.children[i].getBoundingBox());}return bb;};};svg.Element.g.prototype=new svg.Element.RenderedElementBase;svg.Element.symbol=function(node){this.base=svg.Element.RenderedElementBase;this.base(node);this.baseSetContext=this.setContext;this.setContext=function(ctx){this.baseSetContext(ctx);if(this.attribute("viewBox").hasValue()){var viewBox=svg.ToNumberArray(this.attribute("viewBox").value);var minX=viewBox[0];var minY=viewBox[1];width=viewBox[2];height=viewBox[3];svg.AspectRatio(ctx,this.attribute("preserveAspectRatio").value,this.attribute("width").toPixels("x"),width,this.attribute("height").toPixels("y"),height,minX,minY);svg.ViewPort.SetCurrent(viewBox[2],viewBox[3]);}};};svg.Element.symbol.prototype=new svg.Element.RenderedElementBase;svg.Element.style=function(node){this.base=svg.Element.ElementBase;this.base(node);var css="";for(var i=0;i<node.childNodes.length;i++){css+=node.childNodes[i].nodeValue;}css=css.replace(/(\/\*([^*]|[\r\n]|(\*+([^*\/]|[\r\n])))*\*+\/)|(^[\s]*\/\/.*)/gm,"");css=svg.compressSpaces(css);var cssDefs=css.split("}");for(var i=0;i<cssDefs.length;i++){if(svg.trim(cssDefs[i])!=""){var cssDef=cssDefs[i].split("{");var cssClasses=cssDef[0].split(",");var cssProps=cssDef[1].split(";");for(var j=0;j<cssClasses.length;j++){var cssClass=svg.trim(cssClasses[j]);if(cssClass!=""){var props={};for(var k=0;k<cssProps.length;k++){var prop=cssProps[k].indexOf(":");var name=cssProps[k].substr(0,prop);var value=cssProps[k].substr(prop+1,cssProps[k].length-prop);if(name!=null&&value!=null){props[svg.trim(name)]=new svg.Property(svg.trim(name),svg.trim(value));}}svg.Styles[cssClass]=props;if(cssClass=="@font-face"){var fontFamily=props["font-family"].value.replace(/"/g,"");var srcs=props["src"].value.split(",");for(var s=0;s<srcs.length;s++){if(srcs[s].indexOf('format("svg")')>0){var urlStart=srcs[s].indexOf("url");var urlEnd=srcs[s].indexOf(")",urlStart);var url=srcs[s].substr(urlStart+5,urlEnd-urlStart-6);var doc=svg.parseXml(svg.ajax(url));var fonts=doc.getElementsByTagName("font");for(var f=0;f<fonts.length;f++){var font=svg.CreateElement(fonts[f]);svg.Definitions[fontFamily]=font;}}}}}}}}};svg.Element.style.prototype=new svg.Element.ElementBase;svg.Element.use=function(node){this.base=svg.Element.RenderedElementBase;this.base(node);this.baseSetContext=this.setContext;this.setContext=function(ctx){this.baseSetContext(ctx);if(this.attribute("x").hasValue()){ctx.translate(this.attribute("x").toPixels("x"),0);}if(this.attribute("y").hasValue()){ctx.translate(0,this.attribute("y").toPixels("y"));}};this.getDefinition=function(){var element=this.getHrefAttribute().getDefinition();if(this.attribute("width").hasValue()){element.attribute("width",true).value=this.attribute("width").value;}if(this.attribute("height").hasValue()){element.attribute("height",true).value=this.attribute("height").value;}return element;};this.path=function(ctx){var element=this.getDefinition();if(element!=null){element.path(ctx);}};this.getBoundingBox=function(){var element=this.getDefinition();if(element!=null){return element.getBoundingBox();}};this.renderChildren=function(ctx){var element=this.getDefinition();if(element!=null){var oldParent=element.parent;element.parent=null;element.render(ctx);element.parent=oldParent;}};};svg.Element.use.prototype=new svg.Element.RenderedElementBase;svg.Element.mask=function(node){this.base=svg.Element.ElementBase;this.base(node);this.apply=function(ctx,element){var x=this.attribute("x").toPixels("x");var y=this.attribute("y").toPixels("y");var width=this.attribute("width").toPixels("x");var height=this.attribute("height").toPixels("y");if(width==0&&height==0){var bb=new svg.BoundingBox();for(var i=0;i<this.children.length;i++){bb.addBoundingBox(this.children[i].getBoundingBox());}var x=Math.floor(bb.x1);var y=Math.floor(bb.y1);var width=Math.floor(bb.width());var height=Math.floor(bb.height());}var mask=element.attribute("mask").value;element.attribute("mask").value="";var cMask=document.createElement("canvas");cMask.width=x+width;cMask.height=y+height;var maskCtx=cMask.getContext("2d");this.renderChildren(maskCtx);var c=document.createElement("canvas");c.width=x+width;c.height=y+height;var tempCtx=c.getContext("2d");element.render(tempCtx);tempCtx.globalCompositeOperation="destination-in";tempCtx.fillStyle=maskCtx.createPattern(cMask,"no-repeat");tempCtx.fillRect(0,0,x+width,y+height);ctx.fillStyle=tempCtx.createPattern(c,"no-repeat");ctx.fillRect(0,0,x+width,y+height);element.attribute("mask").value=mask;};this.render=function(ctx){};};svg.Element.mask.prototype=new svg.Element.ElementBase;svg.Element.clipPath=function(node){this.base=svg.Element.ElementBase;this.base(node);this.apply=function(ctx){for(var i=0;i<this.children.length;i++){var child=this.children[i];if(typeof(child.path)!="undefined"){var transform=null;if(child.attribute("transform").hasValue()){transform=new svg.Transform(child.attribute("transform").value);transform.apply(ctx);}child.path(ctx);ctx.clip();if(transform){transform.unapply(ctx);}}}};this.render=function(ctx){};};svg.Element.clipPath.prototype=new svg.Element.ElementBase;svg.Element.filter=function(node){this.base=svg.Element.ElementBase;this.base(node);this.apply=function(ctx,element){var bb=element.getBoundingBox();var x=Math.floor(bb.x1);var y=Math.floor(bb.y1);var width=Math.floor(bb.width());var height=Math.floor(bb.height());var filter=element.style("filter").value;element.style("filter").value="";var px=0,py=0;for(var i=0;i<this.children.length;i++){var efd=this.children[i].extraFilterDistance||0;px=Math.max(px,efd);py=Math.max(py,efd);}var c=document.createElement("canvas");c.width=width+2*px;c.height=height+2*py;var tempCtx=c.getContext("2d");tempCtx.translate(-x+px,-y+py);element.render(tempCtx);for(var i=0;i<this.children.length;i++){this.children[i].apply(tempCtx,0,0,width+2*px,height+2*py);}ctx.drawImage(c,0,0,width+2*px,height+2*py,x-px,y-py,width+2*px,height+2*py);element.style("filter",true).value=filter;};this.render=function(ctx){};};svg.Element.filter.prototype=new svg.Element.ElementBase;svg.Element.feMorphology=function(node){this.base=svg.Element.ElementBase;this.base(node);this.apply=function(ctx,x,y,width,height){};};svg.Element.feMorphology.prototype=new svg.Element.ElementBase;svg.Element.feColorMatrix=function(node){this.base=svg.Element.ElementBase;this.base(node);function imGet(img,x,y,width,height,rgba){return img[y*width*4+x*4+rgba];}function imSet(img,x,y,width,height,rgba,val){img[y*width*4+x*4+rgba]=val;}this.apply=function(ctx,x,y,width,height){var srcData=ctx.getImageData(0,0,width,height);for(var y=0;y<height;y++){for(var x=0;x<width;x++){var r=imGet(srcData.data,x,y,width,height,0);var g=imGet(srcData.data,x,y,width,height,1);var b=imGet(srcData.data,x,y,width,height,2);var gray=(r+g+b)/3;imSet(srcData.data,x,y,width,height,0,gray);imSet(srcData.data,x,y,width,height,1,gray);imSet(srcData.data,x,y,width,height,2,gray);}}ctx.clearRect(0,0,width,height);ctx.putImageData(srcData,0,0);};};svg.Element.feColorMatrix.prototype=new svg.Element.ElementBase;svg.Element.feGaussianBlur=function(node){this.base=svg.Element.ElementBase;this.base(node);this.blurRadius=Math.floor(this.attribute("stdDeviation").numValue());this.extraFilterDistance=this.blurRadius;this.apply=function(ctx,x,y,width,height){if(typeof(stackBlurCanvasRGBA)=="undefined"){if(typeof(console)!="undefined"){console.log("ERROR: StackBlur.js must be included for blur to work");}return;}ctx.canvas.id=svg.UniqueId();ctx.canvas.style.display="none";document.body.appendChild(ctx.canvas);stackBlurCanvasRGBA(ctx.canvas.id,x,y,width,height,this.blurRadius);document.body.removeChild(ctx.canvas);};};svg.Element.feGaussianBlur.prototype=new svg.Element.ElementBase;svg.Element.title=function(node){};svg.Element.title.prototype=new svg.Element.ElementBase;svg.Element.desc=function(node){};svg.Element.desc.prototype=new svg.Element.ElementBase;svg.Element.MISSING=function(node){if(typeof(console)!="undefined"){console.log("ERROR: Element '"+node.nodeName+"' not yet implemented.");}};svg.Element.MISSING.prototype=new svg.Element.ElementBase;svg.CreateElement=function(node){var className=node.nodeName.replace(/^[^:]+:/,"");className=className.replace(/\-/g,"");var e=null;if(typeof(svg.Element[className])!="undefined"){e=new svg.Element[className](node);}else{e=new svg.Element.MISSING(node);}e.type=node.nodeName;return e;};svg.load=function(ctx,url){svg.loadXml(ctx,svg.ajax(url));};svg.loadXml=function(ctx,xml){svg.loadXmlDoc(ctx,svg.parseXml(xml));};svg.loadXmlDoc=function(ctx,dom){svg.init(ctx);var mapXY=function(p){var e=ctx.canvas;while(e){p.x-=e.offsetLeft;p.y-=e.offsetTop;e=e.offsetParent;}if(window.scrollX){p.x+=window.scrollX;}if(window.scrollY){p.y+=window.scrollY;}return p;};if(svg.opts["ignoreMouse"]!=true){ctx.canvas.onclick=function(e){var p=mapXY(new svg.Point(e!=null?e.clientX:event.clientX,e!=null?e.clientY:event.clientY));svg.Mouse.onclick(p.x,p.y);};ctx.canvas.onmousemove=function(e){var p=mapXY(new svg.Point(e!=null?e.clientX:event.clientX,e!=null?e.clientY:event.clientY));svg.Mouse.onmousemove(p.x,p.y);};}var e=svg.CreateElement(dom.documentElement);e.root=true;var isFirstRender=true;var draw=function(){svg.ViewPort.Clear();if(ctx.canvas.parentNode){svg.ViewPort.SetCurrent(ctx.canvas.parentNode.clientWidth,ctx.canvas.parentNode.clientHeight);}if(svg.opts["ignoreDimensions"]!=true){if(e.style("width").hasValue()){ctx.canvas.width=e.style("width").toPixels("x");ctx.canvas.style.width=ctx.canvas.width+"px";}if(e.style("height").hasValue()){ctx.canvas.height=e.style("height").toPixels("y");ctx.canvas.style.height=ctx.canvas.height+"px";}}var cWidth=ctx.canvas.clientWidth||ctx.canvas.width;var cHeight=ctx.canvas.clientHeight||ctx.canvas.height;if(svg.opts["ignoreDimensions"]==true&&e.style("width").hasValue()&&e.style("height").hasValue()){cWidth=e.style("width").toPixels("x");cHeight=e.style("height").toPixels("y");}svg.ViewPort.SetCurrent(cWidth,cHeight);if(svg.opts["offsetX"]!=null){e.attribute("x",true).value=svg.opts["offsetX"];}if(svg.opts["offsetY"]!=null){e.attribute("y",true).value=svg.opts["offsetY"];}if(svg.opts["scaleWidth"]!=null&&svg.opts["scaleHeight"]!=null){var xRatio=1,yRatio=1,viewBox=svg.ToNumberArray(e.attribute("viewBox").value);if(e.attribute("width").hasValue()){xRatio=e.attribute("width").toPixels("x")/svg.opts["scaleWidth"];}else{if(!isNaN(viewBox[2])){xRatio=viewBox[2]/svg.opts["scaleWidth"];}}if(e.attribute("height").hasValue()){yRatio=e.attribute("height").toPixels("y")/svg.opts["scaleHeight"];}else{if(!isNaN(viewBox[3])){yRatio=viewBox[3]/svg.opts["scaleHeight"];}}e.attribute("width",true).value=svg.opts["scaleWidth"];e.attribute("height",true).value=svg.opts["scaleHeight"];e.attribute("viewBox",true).value="0 0 "+(cWidth*xRatio)+" "+(cHeight*yRatio);e.attribute("preserveAspectRatio",true).value="none";}if(svg.opts["ignoreClear"]!=true){ctx.clearRect(0,0,cWidth,cHeight);}e.render(ctx);if(isFirstRender){isFirstRender=false;if(typeof(svg.opts["renderCallback"])=="function"){svg.opts["renderCallback"](dom);}}};var waitingForImages=true;if(svg.ImagesLoaded()){waitingForImages=false;draw();}svg.intervalID=setInterval(function(){var needUpdate=false;if(waitingForImages&&svg.ImagesLoaded()){waitingForImages=false;needUpdate=true;}if(svg.opts["ignoreMouse"]!=true){needUpdate=needUpdate|svg.Mouse.hasEvents();}if(svg.opts["ignoreAnimation"]!=true){for(var i=0;i<svg.Animations.length;i++){needUpdate=needUpdate|svg.Animations[i].update(1000/svg.FRAMERATE);}}if(typeof(svg.opts["forceRedraw"])=="function"){if(svg.opts["forceRedraw"]()==true){needUpdate=true;}}if(needUpdate){draw();svg.Mouse.runEvents();}},1000/svg.FRAMERATE);};svg.stop=function(){if(svg.intervalID){clearInterval(svg.intervalID);}};svg.Mouse=new (function(){this.events=[];this.hasEvents=function(){return this.events.length!=0;};this.onclick=function(x,y){this.events.push({type:"onclick",x:x,y:y,run:function(e){if(e.onclick){e.onclick();}}});};this.onmousemove=function(x,y){this.events.push({type:"onmousemove",x:x,y:y,run:function(e){if(e.onmousemove){e.onmousemove();}}});};this.eventElements=[];this.checkPath=function(element,ctx){for(var i=0;i<this.events.length;i++){var e=this.events[i];if(ctx.isPointInPath&&ctx.isPointInPath(e.x,e.y)){this.eventElements[i]=element;}}};this.checkBoundingBox=function(element,bb){for(var i=0;i<this.events.length;i++){var e=this.events[i];if(bb.isPointInBox(e.x,e.y)){this.eventElements[i]=element;}}};this.runEvents=function(){svg.ctx.canvas.style.cursor="";for(var i=0;i<this.events.length;i++){var e=this.events[i];var element=this.eventElements[i];while(element){e.run(element);element=element.parent;}}this.events=[];this.eventElements=[];};});return svg;}})();if(typeof(CanvasRenderingContext2D)!="undefined"){CanvasRenderingContext2D.prototype.drawSvg=function(s,dx,dy,dw,dh){canvg(this.canvas,s,{ignoreMouse:true,ignoreAnimation:true,ignoreDimensions:true,ignoreClear:true,offsetX:dx,offsetY:dy,scaleWidth:dw,scaleHeight:dh});};};var saveAs=saveAs||(typeof navigator!=="undefined"&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator))||(function(view){var doc=view.document,get_URL=function(){return view.URL||view.webkitURL||view;},URL=view.URL||view.webkitURL||view,save_link=doc.createElementNS("http://www.w3.org/1999/xhtml","a"),can_use_save_link=!view.externalHost&&"download" in save_link,click=function(node){var event=doc.createEvent("MouseEvents");event.initMouseEvent("click",true,false,view,0,0,0,0,0,false,false,false,false,0,null);node.dispatchEvent(event);},webkit_req_fs=view.webkitRequestFileSystem,req_fs=view.requestFileSystem||webkit_req_fs||view.mozRequestFileSystem,throw_outside=function(ex){(view.setImmediate||view.setTimeout)(function(){throw ex;},0);},force_saveable_type="application/octet-stream",fs_min_size=0,deletion_queue=[],process_deletion_queue=function(){var i=deletion_queue.length;while(i--){var file=deletion_queue[i];if(typeof file==="string"){URL.revokeObjectURL(file);}else{file.remove();}}deletion_queue.length=0;},dispatch=function(filesaver,event_types,event){event_types=[].concat(event_types);var i=event_types.length;while(i--){var listener=filesaver["on"+event_types[i]];if(typeof listener==="function"){try{listener.call(filesaver,event||filesaver);}catch(ex){throw_outside(ex);}}}},FileSaver=function(blob,name){var filesaver=this,type=blob.type,blob_changed=false,object_url,target_view,get_object_url=function(){var object_url=get_URL().createObjectURL(blob);deletion_queue.push(object_url);return object_url;},dispatch_all=function(){dispatch(filesaver,"writestart progress write writeend".split(" "));},fs_error=function(){if(blob_changed||!object_url){object_url=get_object_url(blob);}if(target_view){target_view.location.href=object_url;}else{window.open(object_url,"_blank");}filesaver.readyState=filesaver.DONE;dispatch_all();},abortable=function(func){return function(){if(filesaver.readyState!==filesaver.DONE){return func.apply(this,arguments);}};},create_if_not_found={create:true,exclusive:false},slice;filesaver.readyState=filesaver.INIT;if(!name){name="download";}if(can_use_save_link){object_url=get_object_url(blob);doc=view.document;save_link=doc.createElementNS("http://www.w3.org/1999/xhtml","a");save_link.href=object_url;save_link.download=name;var event=doc.createEvent("MouseEvents");event.initMouseEvent("click",true,false,view,0,0,0,0,0,false,false,false,false,0,null);save_link.dispatchEvent(event);filesaver.readyState=filesaver.DONE;dispatch_all();return;}if(view.chrome&&type&&type!==force_saveable_type){slice=blob.slice||blob.webkitSlice;blob=slice.call(blob,0,blob.size,force_saveable_type);blob_changed=true;}if(webkit_req_fs&&name!=="download"){name+=".download";}if(type===force_saveable_type||webkit_req_fs){target_view=view;}if(!req_fs){fs_error();return;}fs_min_size+=blob.size;req_fs(view.TEMPORARY,fs_min_size,abortable(function(fs){fs.root.getDirectory("saved",create_if_not_found,abortable(function(dir){var save=function(){dir.getFile(name,create_if_not_found,abortable(function(file){file.createWriter(abortable(function(writer){writer.onwriteend=function(event){target_view.location.href=file.toURL();deletion_queue.push(file);filesaver.readyState=filesaver.DONE;dispatch(filesaver,"writeend",event);};writer.onerror=function(){var error=writer.error;if(error.code!==error.ABORT_ERR){fs_error();}};"writestart progress write abort".split(" ").forEach(function(event){writer["on"+event]=filesaver["on"+event];});writer.write(blob);filesaver.abort=function(){writer.abort();filesaver.readyState=filesaver.DONE;};filesaver.readyState=filesaver.WRITING;}),fs_error);}),fs_error);};dir.getFile(name,{create:false},abortable(function(file){file.remove();save();}),abortable(function(ex){if(ex.code===ex.NOT_FOUND_ERR){save();}else{fs_error();}}));}),fs_error);}),fs_error);},FS_proto=FileSaver.prototype,saveAs=function(blob,name){return new FileSaver(blob,name);};FS_proto.abort=function(){var filesaver=this;filesaver.readyState=filesaver.DONE;dispatch(filesaver,"abort");};FS_proto.readyState=FS_proto.INIT=0;FS_proto.WRITING=1;FS_proto.DONE=2;FS_proto.error=FS_proto.onwritestart=FS_proto.onprogress=FS_proto.onwrite=FS_proto.onabort=FS_proto.onerror=FS_proto.onwriteend=null;view.addEventListener("unload",process_deletion_queue,false);return saveAs;}(this.self||this.window||this.content));if(typeof module!=="undefined"){module.exports=saveAs;}var jsPDF=(function(){if(typeof btoa==="undefined"){window.btoa=function(data){var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",b64a=b64.split(""),o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,enc="",tmp_arr=[],r;do{o1=data.charCodeAt(i++);o2=data.charCodeAt(i++);o3=data.charCodeAt(i++);bits=o1<<16|o2<<8|o3;h1=bits>>18&63;h2=bits>>12&63;h3=bits>>6&63;h4=bits&63;tmp_arr[ac++]=b64a[h1]+b64a[h2]+b64a[h3]+b64a[h4];}while(i<data.length);enc=tmp_arr.join("");r=data.length%3;return(r?enc.slice(0,r-3):enc)+"===".slice(r||3);};}if(typeof atob==="undefined"){window.atob=function(data){var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,dec="",tmp_arr=[];if(!data){return data;}data+="";do{h1=b64.indexOf(data.charAt(i++));h2=b64.indexOf(data.charAt(i++));h3=b64.indexOf(data.charAt(i++));h4=b64.indexOf(data.charAt(i++));bits=h1<<18|h2<<12|h3<<6|h4;o1=bits>>16&255;o2=bits>>8&255;o3=bits&255;if(h3===64){tmp_arr[ac++]=String.fromCharCode(o1);}else{if(h4===64){tmp_arr[ac++]=String.fromCharCode(o1,o2);}else{tmp_arr[ac++]=String.fromCharCode(o1,o2,o3);}}}while(i<data.length);dec=tmp_arr.join("");return dec;};}var getObjectLength=typeof Object.keys==="function"?function(object){return Object.keys(object).length;}:function(object){var i=0,e;for(e in object){if(object.hasOwnProperty(e)){i++;}}return i;},PubSub=function(context){this.topics={};this.context=context;this.publish=function(topic,args){if(this.topics[topic]){var currentTopic=this.topics[topic],toremove=[],fn,i,l,pair,emptyFunc=function(){};args=Array.prototype.slice.call(arguments,1);for(i=0,l=currentTopic.length;i<l;i++){pair=currentTopic[i];fn=pair[0];if(pair[1]){pair[0]=emptyFunc;toremove.push(i);}fn.apply(this.context,args);}for(i=0,l=toremove.length;i<l;i++){currentTopic.splice(toremove[i],1);}}};this.subscribe=function(topic,callback,once){if(!this.topics[topic]){this.topics[topic]=[[callback,once]];}else{this.topics[topic].push([callback,once]);}return{"topic":topic,"callback":callback};};this.unsubscribe=function(token){if(this.topics[token.topic]){var currentTopic=this.topics[token.topic],i,l;for(i=0,l=currentTopic.length;i<l;i++){if(currentTopic[i][0]===token.callback){currentTopic.splice(i,1);}}}};};function jsPDF(orientation,unit,format,compressPdf){if(typeof orientation==="undefined"){orientation="p";}else{orientation=orientation.toString().toLowerCase();}if(typeof unit==="undefined"){unit="mm";}if(typeof format==="undefined"){format="a4";}if(typeof compressPdf==="undefined"&&typeof zpipe==="undefined"){compressPdf=false;}var format_as_string=format.toString().toLowerCase(),version="0.9.0rc2",content=[],content_length=0,compress=compressPdf,pdfVersion="1.3",pageFormats={"a0":[2383.94,3370.39],"a1":[1683.78,2383.94],"a2":[1190.55,1683.78],"a3":[841.89,1190.55],"a4":[595.28,841.89],"a5":[419.53,595.28],"a6":[297.64,419.53],"a7":[209.76,297.64],"a8":[147.4,209.76],"a9":[104.88,147.4],"a10":[73.7,104.88],"b0":[2834.65,4008.19],"b1":[2004.09,2834.65],"b2":[1417.32,2004.09],"b3":[1000.63,1417.32],"b4":[708.66,1000.63],"b5":[498.9,708.66],"b6":[354.33,498.9],"b7":[249.45,354.33],"b8":[175.75,249.45],"b9":[124.72,175.75],"b10":[87.87,124.72],"c0":[2599.37,3676.54],"c1":[1836.85,2599.37],"c2":[1298.27,1836.85],"c3":[918.43,1298.27],"c4":[649.13,918.43],"c5":[459.21,649.13],"c6":[323.15,459.21],"c7":[229.61,323.15],"c8":[161.57,229.61],"c9":[113.39,161.57],"c10":[79.37,113.39],"letter":[612,792],"government-letter":[576,756],"legal":[612,1008],"junior-legal":[576,360],"ledger":[1224,792],"tabloid":[792,1224]},textColor="0 g",drawColor="0 G",page=0,pages=[],objectNumber=2,outToPages=false,offsets=[],fonts={},fontmap={},activeFontSize=16,activeFontKey,lineWidth=0.200025,lineHeightProportion=1.15,pageHeight,pageWidth,k,documentProperties={"title":"","subject":"","author":"","keywords":"","creator":""},lineCapID=0,lineJoinID=0,API={},events=new PubSub(API),tmp,plugin,f2=function(number){return number.toFixed(2);},f3=function(number){return number.toFixed(3);},padd2=function(number){var n=(number).toFixed(0);if(number<10){return"0"+n;}else{return n;}},padd10=function(number){var n=(number).toFixed(0);if(n.length<10){return new Array(11-n.length).join("0")+n;}else{return n;}},out=function(string){if(outToPages){pages[page].push(string);}else{content.push(string);content_length+=string.length+1;}},newObject=function(){objectNumber++;offsets[objectNumber]=content_length;out(objectNumber+" 0 obj");return objectNumber;},putStream=function(str){out("stream");out(str);out("endstream");},wPt,hPt,kids,i,putPages=function(){wPt=pageWidth*k;hPt=pageHeight*k;var n,p,arr,uint,i,deflater,adler32;for(n=1;n<=page;n++){newObject();out("<</Type /Page");out("/Parent 1 0 R");out("/Resources 2 0 R");out("/Contents "+(objectNumber+1)+" 0 R>>");out("endobj");p=pages[n].join("\n");newObject();if(compress){arr=[];for(i=0;i<p.length;++i){arr[i]=p.charCodeAt(i);}adler32=adler32cs.from(p);deflater=new Deflater(6);deflater.append(new Uint8Array(arr));p=deflater.flush();arr=[new Uint8Array([120,156]),new Uint8Array(p),new Uint8Array([adler32&255,(adler32>>8)&255,(adler32>>16)&255,(adler32>>24)&255])];p="";for(i in arr){if(arr.hasOwnProperty(i)){p+=String.fromCharCode.apply(null,arr[i]);}}out("<</Length "+p.length+" /Filter [/FlateDecode]>>");}else{out("<</Length "+p.length+">>");}putStream(p);out("endobj");}offsets[1]=content_length;out("1 0 obj");out("<</Type /Pages");kids="/Kids [";for(i=0;i<page;i++){kids+=(3+2*i)+" 0 R ";}out(kids+"]");out("/Count "+page);out("/MediaBox [0 0 "+f2(wPt)+" "+f2(hPt)+"]");out(">>");out("endobj");},putFont=function(font){font.objectNumber=newObject();out("<</BaseFont/"+font.PostScriptName+"/Type/Font");if(typeof font.encoding==="string"){out("/Encoding/"+font.encoding);}out("/Subtype/Type1>>");out("endobj");},putFonts=function(){var fontKey;for(fontKey in fonts){if(fonts.hasOwnProperty(fontKey)){putFont(fonts[fontKey]);}}},putXobjectDict=function(){events.publish("putXobjectDict");},putResourceDictionary=function(){out("/ProcSet [/PDF /Text /ImageB /ImageC /ImageI]");out("/Font <<");var fontKey;for(fontKey in fonts){if(fonts.hasOwnProperty(fontKey)){out("/"+fontKey+" "+fonts[fontKey].objectNumber+" 0 R");}}out(">>");out("/XObject <<");putXobjectDict();out(">>");},putResources=function(){putFonts();events.publish("putResources");offsets[2]=content_length;out("2 0 obj");out("<<");putResourceDictionary();out(">>");out("endobj");events.publish("postPutResources");},addToFontDictionary=function(fontKey,fontName,fontStyle){var undef;if(fontmap[fontName]===undef){fontmap[fontName]={};}fontmap[fontName][fontStyle]=fontKey;},FontObject={},addFont=function(PostScriptName,fontName,fontStyle,encoding){var fontKey="F"+(getObjectLength(fonts)+1).toString(10),font=fonts[fontKey]={"id":fontKey,"PostScriptName":PostScriptName,"fontName":fontName,"fontStyle":fontStyle,"encoding":encoding,"metadata":{}};addToFontDictionary(fontKey,fontName,fontStyle);events.publish("addFont",font);return fontKey;},addFonts=function(){var HELVETICA="helvetica",TIMES="times",COURIER="courier",NORMAL="normal",BOLD="bold",ITALIC="italic",BOLD_ITALIC="bolditalic",encoding="StandardEncoding",standardFonts=[["Helvetica",HELVETICA,NORMAL],["Helvetica-Bold",HELVETICA,BOLD],["Helvetica-Oblique",HELVETICA,ITALIC],["Helvetica-BoldOblique",HELVETICA,BOLD_ITALIC],["Courier",COURIER,NORMAL],["Courier-Bold",COURIER,BOLD],["Courier-Oblique",COURIER,ITALIC],["Courier-BoldOblique",COURIER,BOLD_ITALIC],["Times-Roman",TIMES,NORMAL],["Times-Bold",TIMES,BOLD],["Times-Italic",TIMES,ITALIC],["Times-BoldItalic",TIMES,BOLD_ITALIC]],i,l,fontKey,parts;for(i=0,l=standardFonts.length;i<l;i++){fontKey=addFont(standardFonts[i][0],standardFonts[i][1],standardFonts[i][2],encoding);parts=standardFonts[i][0].split("-");addToFontDictionary(fontKey,parts[0],parts[1]||"");}events.publish("addFonts",{"fonts":fonts,"dictionary":fontmap});},to8bitStream=function(text,flags){var i,l,undef,sourceEncoding,encodingBlock,outputEncoding,newtext,isUnicode,ch,bch;if(flags===undef){flags={};}sourceEncoding=flags.sourceEncoding?sourceEncoding:"Unicode";outputEncoding=flags.outputEncoding;if((flags.autoencode||outputEncoding)&&fonts[activeFontKey].metadata&&fonts[activeFontKey].metadata[sourceEncoding]&&fonts[activeFontKey].metadata[sourceEncoding].encoding){encodingBlock=fonts[activeFontKey].metadata[sourceEncoding].encoding;if(!outputEncoding&&fonts[activeFontKey].encoding){outputEncoding=fonts[activeFontKey].encoding;}if(!outputEncoding&&encodingBlock.codePages){outputEncoding=encodingBlock.codePages[0];}if(typeof outputEncoding==="string"){outputEncoding=encodingBlock[outputEncoding];}if(outputEncoding){isUnicode=false;newtext=[];for(i=0,l=text.length;i<l;i++){ch=outputEncoding[text.charCodeAt(i)];if(ch){newtext.push(String.fromCharCode(ch));}else{newtext.push(text[i]);}if(newtext[i].charCodeAt(0)>>8){isUnicode=true;}}text=newtext.join("");}}i=text.length;while(isUnicode===undef&&i!==0){if(text.charCodeAt(i-1)>>8){isUnicode=true;}i--;}if(!isUnicode){return text;}else{newtext=flags.noBOM?[]:[254,255];for(i=0,l=text.length;i<l;i++){ch=text.charCodeAt(i);bch=ch>>8;if(bch>>8){throw new Error("Character at position "+i.toString(10)+" of string '"+text+"' exceeds 16bits. Cannot be encoded into UCS-2 BE");}newtext.push(bch);newtext.push(ch-(bch<<8));}return String.fromCharCode.apply(undef,newtext);}},pdfEscape=function(text,flags){return to8bitStream(text,flags).replace(/\\/g,"\\\\").replace(/\(/g,"\\(").replace(/\)/g,"\\)");},putInfo=function(){out("/Producer (jsPDF "+version+")");if(documentProperties.title){out("/Title ("+pdfEscape(documentProperties.title)+")");}if(documentProperties.subject){out("/Subject ("+pdfEscape(documentProperties.subject)+")");}if(documentProperties.author){out("/Author ("+pdfEscape(documentProperties.author)+")");}if(documentProperties.keywords){out("/Keywords ("+pdfEscape(documentProperties.keywords)+")");}if(documentProperties.creator){out("/Creator ("+pdfEscape(documentProperties.creator)+")");}var created=new Date();out("/CreationDate (D:"+[created.getFullYear(),padd2(created.getMonth()+1),padd2(created.getDate()),padd2(created.getHours()),padd2(created.getMinutes()),padd2(created.getSeconds())].join("")+")");},putCatalog=function(){out("/Type /Catalog");out("/Pages 1 0 R");out("/OpenAction [3 0 R /FitH null]");out("/PageLayout /OneColumn");events.publish("putCatalog");},putTrailer=function(){out("/Size "+(objectNumber+1));out("/Root "+objectNumber+" 0 R");out("/Info "+(objectNumber-1)+" 0 R");},beginPage=function(){page++;outToPages=true;pages[page]=[];},_addPage=function(){beginPage();out(f2(lineWidth*k)+" w");out(drawColor);if(lineCapID!==0){out(lineCapID.toString(10)+" J");}if(lineJoinID!==0){out(lineJoinID.toString(10)+" j");}events.publish("addPage",{"pageNumber":page});},getFont=function(fontName,fontStyle){var key,undef;if(fontName===undef){fontName=fonts[activeFontKey].fontName;}if(fontStyle===undef){fontStyle=fonts[activeFontKey].fontStyle;}try{key=fontmap[fontName][fontStyle];}catch(e){key=undef;}if(!key){throw new Error("Unable to look up font label for font '"+fontName+"', '"+fontStyle+"'. Refer to getFontList() for available fonts.");}return key;},buildDocument=function(){outToPages=false;content=[];offsets=[];out("%PDF-"+pdfVersion);putPages();putResources();newObject();out("<<");putInfo();out(">>");out("endobj");newObject();out("<<");putCatalog();out(">>");out("endobj");var o=content_length,i;out("xref");out("0 "+(objectNumber+1));out("0000000000 65535 f ");for(i=1;i<=objectNumber;i++){out(padd10(offsets[i])+" 00000 n ");}out("trailer");out("<<");putTrailer();out(">>");out("startxref");out(o);out("%%EOF");outToPages=true;return content.join("\n");},getStyle=function(style){var op="S";if(style==="F"){op="f";}else{if(style==="FD"||style==="DF"){op="B";}}return op;},output=function(type,options){var undef,data,length,array,i,blob;switch(type){case undef:return buildDocument();case"save":if(navigator.getUserMedia){if(window.URL===undefined){return API.output("dataurlnewwindow");}else{if(window.URL.createObjectURL===undefined){return API.output("dataurlnewwindow");}}}data=buildDocument();length=data.length;array=new Uint8Array(new ArrayBuffer(length));for(i=0;i<length;i++){array[i]=data.charCodeAt(i);}blob=new Blob([array],{type:"application/pdf"});saveAs(blob,options);break;case"datauristring":case"dataurlstring":return"data:application/pdf;base64,"+btoa(buildDocument());case"datauri":case"dataurl":document.location.href="data:application/pdf;base64,"+btoa(buildDocument());break;case"dataurlnewwindow":window.open("data:application/pdf;base64,"+btoa(buildDocument()));break;default:throw new Error('Output type "'+type+'" is not supported.');}};if(unit==="pt"){k=1;}else{if(unit==="mm"){k=72/25.4;}else{if(unit==="cm"){k=72/2.54;}else{if(unit==="in"){k=72;}else{throw ("Invalid unit: "+unit);}}}}if(pageFormats.hasOwnProperty(format_as_string)){pageHeight=pageFormats[format_as_string][1]/k;pageWidth=pageFormats[format_as_string][0]/k;}else{try{pageHeight=format[1];pageWidth=format[0];}catch(err){throw ("Invalid format: "+format);}}if(orientation==="p"||orientation==="portrait"){orientation="p";if(pageWidth>pageHeight){tmp=pageWidth;pageWidth=pageHeight;pageHeight=tmp;}}else{if(orientation==="l"||orientation==="landscape"){orientation="l";if(pageHeight>pageWidth){tmp=pageWidth;pageWidth=pageHeight;pageHeight=tmp;}}else{throw ("Invalid orientation: "+orientation);}}API.internal={"pdfEscape":pdfEscape,"getStyle":getStyle,"getFont":function(){return fonts[getFont.apply(API,arguments)];},"getFontSize":function(){return activeFontSize;},"getLineHeight":function(){return activeFontSize*lineHeightProportion;},"btoa":btoa,"write":function(string1,string2,string3,etc){out(arguments.length===1?string1:Array.prototype.join.call(arguments," "));},"getCoordinateString":function(value){return f2(value*k);},"getVerticalCoordinateString":function(value){return f2((pageHeight-value)*k);},"collections":{},"newObject":newObject,"putStream":putStream,"events":events,"scaleFactor":k,"pageSize":{"width":pageWidth,"height":pageHeight},"output":function(type,options){return output(type,options);},"getNumberOfPages":function(){return pages.length-1;},"pages":pages};API.addPage=function(){_addPage();return this;};API.text=function(text,x,y,flags){var undef,_first,_second,_third,newtext,str,i;if(typeof text==="number"){_first=y;_second=text;_third=x;text=_first;x=_second;y=_third;}if(typeof text==="string"&&text.match(/[\n\r]/)){text=text.split(/\r\n|\r|\n/g);}if(typeof flags==="undefined"){flags={"noBOM":true,"autoencode":true};}else{if(flags.noBOM===undef){flags.noBOM=true;}if(flags.autoencode===undef){flags.autoencode=true;}}if(typeof text==="string"){str=pdfEscape(text,flags);}else{if(text instanceof Array){newtext=text.concat();for(i=newtext.length-1;i!==-1;i--){newtext[i]=pdfEscape(newtext[i],flags);}str=newtext.join(") Tj\nT* (");}else{throw new Error('Type of text must be string or Array. "'+text+'" is not recognized.');}}out("BT\n/"+activeFontKey+" "+activeFontSize+" Tf\n"+(activeFontSize*lineHeightProportion)+" TL\n"+textColor+"\n"+f2(x*k)+" "+f2((pageHeight-y)*k)+" Td\n("+str+") Tj\nET");return this;};API.line=function(x1,y1,x2,y2){out(f2(x1*k)+" "+f2((pageHeight-y1)*k)+" m "+f2(x2*k)+" "+f2((pageHeight-y2)*k)+" l S");return this;};API.lines=function(lines,x,y,scale,style,closed){var undef,_first,_second,_third,scalex,scaley,i,l,leg,x2,y2,x3,y3,x4,y4;if(typeof lines==="number"){_first=y;_second=lines;_third=x;lines=_first;x=_second;y=_third;}style=getStyle(style);scale=scale===undef?[1,1]:scale;out(f3(x*k)+" "+f3((pageHeight-y)*k)+" m ");scalex=scale[0];scaley=scale[1];l=lines.length;x4=x;y4=y;for(i=0;i<l;i++){leg=lines[i];if(leg.length===2){x4=leg[0]*scalex+x4;y4=leg[1]*scaley+y4;out(f3(x4*k)+" "+f3((pageHeight-y4)*k)+" l");}else{x2=leg[0]*scalex+x4;y2=leg[1]*scaley+y4;x3=leg[2]*scalex+x4;y3=leg[3]*scaley+y4;x4=leg[4]*scalex+x4;y4=leg[5]*scaley+y4;out(f3(x2*k)+" "+f3((pageHeight-y2)*k)+" "+f3(x3*k)+" "+f3((pageHeight-y3)*k)+" "+f3(x4*k)+" "+f3((pageHeight-y4)*k)+" c");}}if(closed==true){out(" h");}out(style);return this;};API.rect=function(x,y,w,h,style){var op=getStyle(style);out([f2(x*k),f2((pageHeight-y)*k),f2(w*k),f2(-h*k),"re",op].join(" "));return this;};API.triangle=function(x1,y1,x2,y2,x3,y3,style){this.lines([[x2-x1,y2-y1],[x3-x2,y3-y2],[x1-x3,y1-y3]],x1,y1,[1,1],style,true);return this;};API.roundedRect=function(x,y,w,h,rx,ry,style){var MyArc=4/3*(Math.SQRT2-1);this.lines([[(w-2*rx),0],[(rx*MyArc),0,rx,ry-(ry*MyArc),rx,ry],[0,(h-2*ry)],[0,(ry*MyArc),-(rx*MyArc),ry,-rx,ry],[(-w+2*rx),0],[-(rx*MyArc),0,-rx,-(ry*MyArc),-rx,-ry],[0,(-h+2*ry)],[0,-(ry*MyArc),(rx*MyArc),-ry,rx,-ry]],x+rx,y,[1,1],style);return this;};API.ellipse=function(x,y,rx,ry,style){var op=getStyle(style),lx=4/3*(Math.SQRT2-1)*rx,ly=4/3*(Math.SQRT2-1)*ry;out([f2((x+rx)*k),f2((pageHeight-y)*k),"m",f2((x+rx)*k),f2((pageHeight-(y-ly))*k),f2((x+lx)*k),f2((pageHeight-(y-ry))*k),f2(x*k),f2((pageHeight-(y-ry))*k),"c"].join(" "));out([f2((x-lx)*k),f2((pageHeight-(y-ry))*k),f2((x-rx)*k),f2((pageHeight-(y-ly))*k),f2((x-rx)*k),f2((pageHeight-y)*k),"c"].join(" "));out([f2((x-rx)*k),f2((pageHeight-(y+ly))*k),f2((x-lx)*k),f2((pageHeight-(y+ry))*k),f2(x*k),f2((pageHeight-(y+ry))*k),"c"].join(" "));out([f2((x+lx)*k),f2((pageHeight-(y+ry))*k),f2((x+rx)*k),f2((pageHeight-(y+ly))*k),f2((x+rx)*k),f2((pageHeight-y)*k),"c",op].join(" "));return this;};API.circle=function(x,y,r,style){return this.ellipse(x,y,r,r,style);};API.setProperties=function(properties){var property;for(property in documentProperties){if(documentProperties.hasOwnProperty(property)&&properties[property]){documentProperties[property]=properties[property];}}return this;};API.setFontSize=function(size){activeFontSize=size;return this;};API.setFont=function(fontName,fontStyle){activeFontKey=getFont(fontName,fontStyle);return this;};API.setFontStyle=API.setFontType=function(style){var undef;activeFontKey=getFont(undef,style);return this;};API.getFontList=function(){var list={},fontName,fontStyle,tmp;for(fontName in fontmap){if(fontmap.hasOwnProperty(fontName)){list[fontName]=tmp=[];for(fontStyle in fontmap[fontName]){if(fontmap[fontName].hasOwnProperty(fontStyle)){tmp.push(fontStyle);}}}}return list;};API.setLineWidth=function(width){out((width*k).toFixed(2)+" w");return this;};API.setDrawColor=function(ch1,ch2,ch3,ch4){var color;if(ch2===undefined||(ch4===undefined&&ch1===ch2===ch3)){if(typeof ch1==="string"){color=ch1+" G";}else{color=f2(ch1/255)+" G";}}else{if(ch4===undefined){if(typeof ch1==="string"){color=[ch1,ch2,ch3,"RG"].join(" ");}else{color=[f2(ch1/255),f2(ch2/255),f2(ch3/255),"RG"].join(" ");}}else{if(typeof ch1==="string"){color=[ch1,ch2,ch3,ch4,"K"].join(" ");}else{color=[f2(ch1),f2(ch2),f2(ch3),f2(ch4),"K"].join(" ");}}}out(color);return this;};API.setFillColor=function(ch1,ch2,ch3,ch4){var color;if(ch2===undefined||(ch4===undefined&&ch1===ch2===ch3)){if(typeof ch1==="string"){color=ch1+" g";}else{color=f2(ch1/255)+" g";}}else{if(ch4===undefined){if(typeof ch1==="string"){color=[ch1,ch2,ch3,"rg"].join(" ");}else{color=[f2(ch1/255),f2(ch2/255),f2(ch3/255),"rg"].join(" ");}}else{if(typeof ch1==="string"){color=[ch1,ch2,ch3,ch4,"k"].join(" ");}else{color=[f2(ch1),f2(ch2),f2(ch3),f2(ch4),"k"].join(" ");}}}out(color);return this;};API.setTextColor=function(r,g,b){var patt=/#[0-9A-Fa-f]{6}/;if((typeof r=="string")&&patt.test(r)){var hex=r.replace("#","");var bigint=parseInt(hex,16);r=(bigint>>16)&255;g=(bigint>>8)&255;b=bigint&255;}if((r===0&&g===0&&b===0)||(typeof g==="undefined")){textColor=f3(r/255)+" g";}else{textColor=[f3(r/255),f3(g/255),f3(b/255),"rg"].join(" ");}return this;};API.CapJoinStyles={0:0,"butt":0,"but":0,"miter":0,1:1,"round":1,"rounded":1,"circle":1,2:2,"projecting":2,"project":2,"square":2,"bevel":2};API.setLineCap=function(style){var id=this.CapJoinStyles[style];if(id===undefined){throw new Error("Line cap style of '"+style+"' is not recognized. See or extend .CapJoinStyles property for valid styles");}lineCapID=id;out(id.toString(10)+" J");return this;};API.setLineJoin=function(style){var id=this.CapJoinStyles[style];if(id===undefined){throw new Error("Line join style of '"+style+"' is not recognized. See or extend .CapJoinStyles property for valid styles");}lineJoinID=id;out(id.toString(10)+" j");return this;};API.output=output;API.save=function(filename){API.output("save",filename);};for(plugin in jsPDF.API){if(jsPDF.API.hasOwnProperty(plugin)){if(plugin==="events"&&jsPDF.API.events.length){(function(events,newEvents){var eventname,handler_and_args,i;for(i=newEvents.length-1;i!==-1;i--){eventname=newEvents[i][0];handler_and_args=newEvents[i][1];events.subscribe.apply(events,[eventname].concat(typeof handler_and_args==="function"?[handler_and_args]:handler_and_args));}}(events,jsPDF.API.events));}else{API[plugin]=jsPDF.API[plugin];}}}addFonts();activeFontKey="F1";_addPage();events.publish("initialized");return API;}jsPDF.API={"events":[]};return jsPDF;}());(function(jsPDFAPI){var namespace="addImage_";var getJpegSize=function(imgData){var width,height;if(!imgData.charCodeAt(0)===255||!imgData.charCodeAt(1)===216||!imgData.charCodeAt(2)===255||!imgData.charCodeAt(3)===224||!imgData.charCodeAt(6)==="J".charCodeAt(0)||!imgData.charCodeAt(7)==="F".charCodeAt(0)||!imgData.charCodeAt(8)==="I".charCodeAt(0)||!imgData.charCodeAt(9)==="F".charCodeAt(0)||!imgData.charCodeAt(10)===0){throw new Error("getJpegSize requires a binary jpeg file");}var blockLength=imgData.charCodeAt(4)*256+imgData.charCodeAt(5);var i=4,len=imgData.length;while(i<len){i+=blockLength;if(imgData.charCodeAt(i)!==255){throw new Error("getJpegSize could not find the size of the image");}if(imgData.charCodeAt(i+1)===192||imgData.charCodeAt(i+1)===193||imgData.charCodeAt(i+1)===194||imgData.charCodeAt(i+1)===195||imgData.charCodeAt(i+1)===196||imgData.charCodeAt(i+1)===197||imgData.charCodeAt(i+1)===198||imgData.charCodeAt(i+1)===199){height=imgData.charCodeAt(i+5)*256+imgData.charCodeAt(i+6);width=imgData.charCodeAt(i+7)*256+imgData.charCodeAt(i+8);return[width,height];}else{i+=2;blockLength=imgData.charCodeAt(i)*256+imgData.charCodeAt(i+1);}}},putImage=function(img){var objectNumber=this.internal.newObject(),out=this.internal.write,putStream=this.internal.putStream;img["n"]=objectNumber;out("<</Type /XObject");out("/Subtype /Image");out("/Width "+img["w"]);out("/Height "+img["h"]);if(img["cs"]==="Indexed"){out("/ColorSpace [/Indexed /DeviceRGB "+(img["pal"].length/3-1)+" "+(objectNumber+1)+" 0 R]");}else{out("/ColorSpace /"+img["cs"]);if(img["cs"]==="DeviceCMYK"){out("/Decode [1 0 1 0 1 0 1 0]");}}out("/BitsPerComponent "+img["bpc"]);if("f" in img){out("/Filter /"+img["f"]);}if("dp" in img){out("/DecodeParms <<"+img["dp"]+">>");}if("trns" in img&&img["trns"].constructor==Array){var trns="";for(var i=0;i<img["trns"].length;i++){trns+=(img[trns][i]+" "+img["trns"][i]+" ");out("/Mask ["+trns+"]");}}if("smask" in img){out("/SMask "+(objectNumber+1)+" 0 R");}out("/Length "+img["data"].length+">>");putStream(img["data"]);out("endobj");},putResourcesCallback=function(){var images=this.internal.collections[namespace+"images"];for(var i in images){putImage.call(this,images[i]);}},putXObjectsDictCallback=function(){var images=this.internal.collections[namespace+"images"],out=this.internal.write,image;for(var i in images){image=images[i];out("/I"+image["i"],image["n"],"0","R");}};jsPDFAPI.addImage=function(imageData,format,x,y,w,h){if(typeof imageData==="object"&&imageData.nodeType===1){var canvas=document.createElement("canvas");canvas.width=imageData.clientWidth;canvas.height=imageData.clientHeight;var ctx=canvas.getContext("2d");if(!ctx){throw ("addImage requires canvas to be supported by browser.");}ctx.drawImage(imageData,0,0,canvas.width,canvas.height);imageData=canvas.toDataURL("image/jpeg");format="JPEG";}if(format.toUpperCase()!=="JPEG"){throw new Error("addImage currently only supports format 'JPEG', not '"+format+"'");}var imageIndex,images=this.internal.collections[namespace+"images"],coord=this.internal.getCoordinateString,vcoord=this.internal.getVerticalCoordinateString;if(imageData.substring(0,23)==="data:image/jpeg;base64,"){imageData=atob(imageData.replace("data:image/jpeg;base64,",""));}if(images){imageIndex=Object.keys?Object.keys(images).length:(function(o){var i=0;for(var e in o){if(o.hasOwnProperty(e)){i++;}}return i;})(images);}else{imageIndex=0;this.internal.collections[namespace+"images"]=images={};this.internal.events.subscribe("putResources",putResourcesCallback);this.internal.events.subscribe("putXobjectDict",putXObjectsDictCallback);}var dims=getJpegSize(imageData);var info={w:dims[0],h:dims[1],cs:"DeviceRGB",bpc:8,f:"DCTDecode",i:imageIndex,data:imageData};images[imageIndex]=info;if(!w&&!h){w=-96;h=-96;}if(w<0){w=(-1)*info["w"]*72/w/this.internal.scaleFactor;}if(h<0){h=(-1)*info["h"]*72/h/this.internal.scaleFactor;}if(w===0){w=h*info["w"]/info["h"];}if(h===0){h=w*info["h"]/info["w"];}this.internal.write("q",coord(w),"0 0",coord(h),coord(x),vcoord(y+h),"cm /I"+info["i"],"Do Q");return this;};})(jsPDF.API);